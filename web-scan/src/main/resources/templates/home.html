<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" ng-app="product">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- Bootstrap -->
    <link href="font-awesome-4.1.0/font-awesome-4.1.0.min.css" rel="stylesheet"/>
    <link href="bootstrap-3.3.4-dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="AdminLTE/AdminLTE.min.css" rel="stylesheet"/>
    <script src="angular-1.3.15/angular.js" type="text/javascript"></script>
    <script src="jquery-2.1.3/jquery-2.1.3.min.js" type="text/javascript"></script>
    <script src="bootstrap-3.3.4-dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="pages/datetime-0.1.js" type="text/javascript"></script>
</head>
<body>
<!-- Content Header (Page header) -->
<script type="text/javascript">
    (function () {
        var app = angular.module("product", []);

        app.factory("productService", ["$http", function ($http) {
            return {
//                getInfo: function (postObject, fnSuccess, fnError) {
//                    $http.post("/api/scan/mobile", postObject)
//                            .success(function (data) {
//                                fnSuccess(data);
//                            }).error(function (data, state) {
//                                fnSuccess();
//                            });
//                }

                getInfo: function (postObject, fnSuccess, fnError) {
                    $http.get("mock/mock.json")
                            .success(function (data) {
                                fnSuccess(data);
                            });
                }
            };
        }]);

        app.controller("productCtrl", ["$scope", "productService", function ($scope, productService) {

            $scope.productKey = '<p th:text="${key}"/>';
            $scope.productKey = $scope.productKey.replace("<p>", "");
            $scope.productKey = $scope.productKey.replace("</p>", "");

            var postObject = {
                key: $scope.productKey,
                deviceCode: 'UIDSL-SD832-230DS-623043',
                location: '用户选择不公开',
                latitude: 120.798,
                longitude: 34.678
            };

            $scope.getDateString = function (value) {
                var date = new Date(value);
                return new DateTime(date).toString('yyyy-MM-dd HH:mm:ss');
            };

            $scope.productKeyClick = function () {

                if ($scope.productKey == null || $scope.productKey == "") {
                    return;
                }

                productService.getInfo(postObject, function (data) {
                    $scope.data = data;

                    if ($scope.data.product.details != null) {

                        $scope.detailItems = [];
                        var details = $scope.data.product.details.split(";");
                        for (var detail in details) {
                            var dat = details[detail];
                            var datItems = dat.split(":");

                            var item = {};
                            item.text = datItems[0];
                            item.value = datItems[1];
                            $scope.detailItems.push(item);
                        }
                    }

                    if ($scope.data.logisticses != null) {
                        $scope.latestLogistics = $scope.data.logisticses[0];

                        $scope.otherLogistics = $scope.data.logisticses.slice(1);
                    }
                });
            };

            $scope.productKeyClick();
        }]);
    })();
</script>
<div ng-controller="productCtrl" class="container">
    <div class="row">
        <div class="col-xs-18 col-md-12">
            下载：
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 col-md-8">
            <img src="" class="img-rounded"/>
        </div>
        <div class="col-xs-6 col-md-4">
            <img src="" class="img-rounded"/>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-9 col-md-6"><img src="" class="img-rounded"/></div>
        <div class="col-xs-9 col-md-6"><p class="text-center">本产品是真品</p>

            <p class="text-center">还有730天过期</p></div>
    </div>

    <div class="row">
        <div class="col-xs-18 col-md-12">
            <div class="nav-tabs-custom">
                <ul class="nav nav-tabs">
                    <li class="active"><a id="tab_a_1" data-toggle="tab" href="#tab_1"><i
                            class="fa fa-briefcase"></i>基本信息</a></li>
                    <li><a id="tab_a_2" data-toggle="tab" href="#tab_2"><i
                            class="fa fa-truck"></i>扫描信息</a></li>
                    <li><a id="tab_a_3" data-toggle="tab" href="#tab_3"><i
                            class="fa fa-truck"></i>物流跟踪</a></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane active" id="tab_1">
                        <div class="panel box box-primary">
                            <div class="table-responsive">
                                <table class="table table-condensed">
                                    <tr>
                                        <td>商品码</td>
                                        <td>{{data.product.productKey}}</td>
                                    </tr>
                                    <tr>
                                        <td>物品名称</td>
                                        <td>{{data.product.name}}</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">商品描述</td>
                                    </tr>
                                    <tr>
                                        <td colspan="2">
                                            <table class="table table-condensed">
                                                <tr ng-repeat="detail in detailItems">
                                                    <td>{{detail.text}}</td>
                                                    <td>{{detail.value}}</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane" id="tab_2">
                        <div class="panel box box-primary">
                            <div class="table-responsive">
                                <table class="table table-condensed">
                                    <tr ng-repeat="scan in data.scanRecord">
                                        <td>{{scan.detail}}</td>
                                        <td>{{getDateString(scan.createdDateTime)}}</td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane" id="tab_3">
                        <div class="panel box box-primary">
                            <ul class="timeline">
                                <li>
                                    <i class="fa fa-envelope bg-red"></i>

                                    <div class="timeline-item">
                                        <h3 class="timeline-header">{{getDateString(latestLogistics.dateTime)}}
                                            {{latestLogistics.message}} {{latestLogistics.location}}</h3>
                                    </div>
                                </li>
                                <li ng-repeat="logistics in otherLogistics">
                                    <i class="fa fa-envelope bg-blue"></i>

                                    <div class="timeline-item">
                                        <h3 class="timeline-header">{{getDateString(logistics.dateTime)}}
                                            {{logistics.message}} {{logistics.location}}</h3>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
