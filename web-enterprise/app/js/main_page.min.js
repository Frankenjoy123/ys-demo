!function (e) {
  var t = angular.module("root", ["ngRoute", "YUNSOO_CONFIG", "utils", "interceptor", "angularFileUpload", "dataFilterService"]);
  t.config(["$routeProvider", function (e) {
    e.when("/dashboard", {
      templateUrl: "pages/dashboard/dashboard.html",
      controller: "DashboardCtrl"
    }).when("/account", {
      templateUrl: "pages/account/account-manage.html",
      controller: "AccountManageCtrl"
    }).when("/product-base-manage", {
      templateUrl: "pages/product/product-base-manage.html",
      controller: "ProductBaseManageCtrl"
    }).when("/product-key-manage", {
      templateUrl: "pages/product/product-key-manage.html",
      controller: "ProductKeyManageCtrl"
    }).when("/message", {
      templateUrl: "pages/message/message.html",
      controller: "MessageCtrl"
    }).when("/package-manage", {
      templateUrl: "pages/package/packageManage.html",
      controller: "PackageCtrl"
    }).when("/package-search", {
      templateUrl: "pages/package/packageSearch.html",
      controller: "PackageSearchCtrl"
    }).when("/logistics", {
      templateUrl: "pages/logistics/logistics.html",
      controller: "LogisticsManageCtrl"
    }).when("/search", {
      templateUrl: "pages/search/search.html",
      controller: "SearchCtrl"
    }).when("/setting", {
      templateUrl: "pages/setting/setting.html",
      controller: "SettingCtrl"
    }).when("/emulator", {
      templateUrl: "pages/emulator/emulator.html",
      controller: "emulatorCtrl"
    }).when("/device", {
      templateUrl: "pages/device/device.html",
      controller: "deviceCtrl"
    }).when("/echarts-bar", {
      templateUrl: "pages/echarts/echarts-bar.html",
      controller: "echartsBarCtrl"
    }).when("/stacked-bar", {
      templateUrl: "pages/echarts/stacked-bar.html",
      controller: "stackedBarCtrl"
    }).when("/mix-map", {
      templateUrl: "pages/echarts/mix-map.html",
      controller: "mixMapCtrl"
    }).when("/pie-map", {
      templateUrl: "pages/echarts/pie-map.html",
      controller: "pieMapCtrl"
    }).when("/group", {
      templateUrl: "pages/group/group.html",
      controller: "groupCtrl"
    }).when("/no_access", {templateUrl: "403.html"}).otherwise({
      templateUrl: "pages/dashboard/dashboard.html",
      controller: "DashboardCtrl"
    })
  }]), t.factory("rootService", ["$http", "$rootScope", function (e, t) {
    return {
      initContext: function () {
        var n = this;
        e.get("/api/account/current").success(function (e) {
          n.account = e, console.log("[get current account]", e)
        }).error(function (e, t) {
          console.log("[get current account]", "failed", t)
        }), e.get("/api/organization/current").success(function (e) {
          n.organization = e, console.log("[get current organization]", e), t.$broadcast("context-organization-ready")
        }).error(function (e, t) {
          console.log("[get current organization]", "failed", t)
        })
      }, refreshAccessToken: function (t, n) {
        t && e.get("/api/auth/accesstoken?permanent_token=" + t).success(n)
      }, getAccountAllPermissions: function (t, n) {
        var o = "/api/account/current/permission";
        e.get(o).success(t).error(n)
      }
    }
  }]), t.controller("rootCtrl", ["$scope", "$timeout", "$http", "YUNSOO_CONFIG", "utils", "rootService", "productBaseManageService", "$location", function (t, n, o, a, c, r, i, u) {
    function s(n) {
      var o = !1;
      f(l.DASHBOARD, d.READ) || (e("#liDashBoard").attr("style", "display:none"), "/dashboard" == n && u.path("/no_access")), f(l.PRODUCTKEY, d.READ) || f(l.PRODUCTKEY, d.MANAGE) ? f(l.PRODUCTKEY, d.READ) && !f(l.PRODUCTKEY, d.MANAGE) ? t.productKeyButtonShow = !1 : f(l.PRODUCTKEY, d.MANAGE) && (t.productKeyButtonShow = !0) : (e("#liProductKey").attr("style", "display:none"), "/product-key-manage" == n && u.path("/no_access")), f(l.PACKAGE, d.READ) || f(l.PACKAGE, d.MANAGE) ? f(l.PACKAGE, d.READ) && !f(l.PACKAGE, d.MANAGE) ? t.packageButtonShow = !1 : f(l.PACKAGE, d.MANAGE) && (t.packageButtonShow = !0) : (e("#liPackageManage").attr("style", "display:none"), "/package-manage" == n && u.path("/no_access")), f(l.LOGISTICS, d.READ) || f(l.LOGISTICS, d.MANAGE) ? f(l.LOGISTICS, d.READ) && !f(l.LOGISTICS, d.MANAGE) ? t.logisticsButtonShow = !1 : f(l.LOGISTICS, d.MANAGE) && (t.logisticsButtonShow = !0) : (e("#liLogistics").attr("style", "display:none"), "/logistics" == n && u.path("/no_access")), f(l.REPORT, d.READ) || (e("#liAllCharts").attr("style", "display:none"), ("/echarts-bar" == n || "/stacked-bar" == n || "/mix-map" == n || "/pie-map" == n) && u.path("/no_access")), f(l.PRODUCTBASE, d.READ) || f(l.PRODUCTBASE, d.MANAGE) ? f(l.LOGISTICS, d.READ) && !f(l.LOGISTICS, d.MANAGE) ? t.productBaseButtonShow = !1 : f(l.LOGISTICS, d.MANAGE) ? t.productBaseButtonShow = !0 : o = !0 : (e("#liProductBase").attr("style", "display:none"), ("/product-base-manage" == n || "/emulator" == n) && u.path("/no_access")), f(l.MESSAGE, d.READ) || f(l.MESSAGE, d.MANAGE) ? f(l.MESSAGE, d.READ) && !f(l.MESSAGE, d.MANAGE) ? t.messageButtonShow = !1 : f(l.MESSAGE, d.MANAGE) ? t.messageButtonShow = !0 : o = !0 : (e("#liMessage").attr("style", "display:none"), "/message" == n && u.path("/no_access")), f(l.DEVICE, d.READ) || f(l.DEVICE, d.MANAGE) ? f(l.DEVICE, d.READ) && !f(l.DEVICE, d.MANAGE) ? t.deviceButtonShow = !1 : f(l.DEVICE, d.MANAGE) ? t.deviceButtonShow = !0 : o = !0 : (e("#liDevice").attr("style", "display:none"), "/device" == n && u.path("/no_access")), f(l.ACCOUNT, d.READ) || f(l.ACCOUNT, d.MANAGE) ? f(l.ACCOUNT, d.READ) && !f(l.ACCOUNT, d.MANAGE) ? t.accountButtonShow = !1 : f(l.ACCOUNT, d.MANAGE) ? t.accountButtonShow = !0 : o = !0 : (e("#liAccount").attr("style", "display:none"), "/account" == n && u.path("/no_access")), f(l.GROUP, d.READ) || f(l.GROUP, d.MANAGE) ? f(l.GROUP, d.READ) && !f(l.GROUP, d.MANAGE) ? t.groupButtonShow = !1 : f(l.GROUP, d.MANAGE) ? t.groupButtonShow = !0 : o = !0 : (e("#liGroup").attr("style", "display:none"), "/group" == n && u.path("/no_access")), f(l.PROFILE, d.READ) ? o = !0 : (e("#liPassword").attr("style", "display:none"), "/setting" == n && u.path("/no_access")), o || e("#liAllSettings").attr("style", "display:none")
    }

    console.log("[root controller start]");
    var l = a.PAGE_ACCESS.RESOURCE, d = a.PAGE_ACCESS.ACTION;
    t.YUNSOO_CONFIG = a, t.utils = c, t.context = {}, window._debug && (window._debug.context = t.context);
    var p = c.auth.getAuth();
    p && c.auth.getPermanentToken() ? setTimeout(function g() {
      r.refreshAccessToken(c.auth.getPermanentToken(), function (e) {
        console.log("[access token]", "refreshed successfully"), c.auth.setAccessToken(e.token, DateTime.now().addSeconds(e.expires_in).valueOf()), e.expires_in > 60 && setTimeout(g, e.expires_in / 1.2 * 1e3)
      })
    }, new DateTime(p.accessToken.expires).addSeconds(-30) - DateTime.now()) : window.location.href = "login.html", t.productKeyCreditSum = {
      total: 0,
      remain: 0,
      percentage: 0
    }, r.initContext.apply(t.context), i.getProductKeyCredits(function (n) {
      var o = t.productKeyCreditSum;
      e.each(n, function (e, t) {
        o.total += t.total, o.remain += t.remain
      }), o.percentage = 100 * o.remain / o.total | 0, console.log("[get productKeyCreditSum]: ", o), o.ready = !0, t.$broadcast("productKeyCreditSum-ready", o)
    }), r.getAccountAllPermissions(function (e) {
      t.currAccountAllPermissions = e, t.$broadcast("accountPermissions-ready", e)
    });
    var f = t.hasAccess = function (e, n) {
      var o = t.currAccountAllPermissions;
      if (o)for (var a = 0; a < o.length; a++) {
        if ("*" == o[a].resource_code && "*" == o[a].action_code)return !0;
        if (o[a].resource_code == e && o[a].action_code == n)return !0
      }
      return !1
    };
    t.$on("$routeChangeSuccess", function (e, n, o) {
      var a = n.$$route ? n.$$route.originalPath : "/dashboard";
      t.currAccountAllPermissions ? s(a) : t.$on("accountPermissions-ready", function (e) {
        s(a)
      })
    }), n(function () {
      t.utils.notification("info", "欢迎登陆云溯管理平台")
    }, 3e3), console.log("[root controller end]")
  }]), t.directive("scrollTop", function () {
    return {
      restrict: "A", scope: !0, link: function (t, n, o) {
        if (!nifty.isMobile) {
          var a = !1, c = 250, r = e(window), i = e("body, html");
          r.scroll(function () {
            r.scrollTop() > c && !a ? (n.addClass("in"), a = !0) : r.scrollTop() < c && a && (n.removeClass("in"), a = !1)
          }), n.on("click", function (e) {
            e.preventDefault(), i.animate({scrollTop: 0}, 500)
          })
        }
      }
    }
  })
}(jQuery), function () {
  var e = angular.module("login", ["interceptor", "YUNSOO_CONFIG", "utils"]);
  e.factory("loginService", ["$http", function (e) {
    return {
      login: function (t, n, o) {
        e.post("/api/auth/login/password", {
          organization: t.organization,
          identifier: t.identifier,
          password: t.password
        }).success(n).error(o)
      }, loginForm: function (e) {
        return e ? void(localStorage.loginForm = JSON.stringify(e)) : localStorage.loginForm ? JSON.parse(localStorage.loginForm) : null
      }
    }
  }]), e.controller("LoginCtrl", ["$scope", "$timeout", "loginService", "YUNSOO_CONFIG", "utils", function (e, t, n, o, a) {
    function c() {
      var o = e.loginForm;
      o.organization = $.trim(o.organization), o.identifier = $.trim(o.identifier), console.log("[before login]", "organization:", o.organization, "identifier:", o.identifier), n.login(o, function (e) {
        return e && e.access_token && e.access_token.token ? (a.auth.setAccessToken(e.access_token.token, DateTime.now().addSeconds(e.access_token.expires_in).valueOf()), a.auth.setPermanentToken(e.permanent_token.token, DateTime.now().addSeconds(e.permanent_token.expires_in).valueOf()), o.rememberMe && (o.password = "", console.log("[saving login form]"), n.loginForm(o)), $("body").addClass("animated fadeOut"), $("#panel-login").addClass("animated zoomOut"), void t(function () {
          window.location.href = "./"
        }, 1e3)) : void $.niftyNoty({
          type: "danger",
          container: "#panel-login",
          html: "登陆失败请稍后再试",
          focus: !1,
          timer: 3e3
        })
      }, function (t, n) {
        console.log("[login failed]", t.message, n), e.loginForm.password = "", $.niftyNoty({
          type: "danger",
          container: "#panel-login",
          html: "账号或密码错误",
          focus: !1,
          timer: 3e3
        })
      })
    }

    (e.loginForm = n.loginForm()) || (e.loginForm = {
      organization: "",
      identifier: "",
      password: "",
      rememberMe: !1
    }), t(function () {
      $("form.bv-form").bootstrapValidator({
        message: "非法输入",
        feedbackIcons: {
          valid: "fa fa-check-circle fa-lg text-success",
          invalid: "fa fa-times-circle fa-lg",
          validating: "fa fa-refresh"
        },
        fields: {
          organization: {validators: {notEmpty: {message: "组织名称不可空"}}},
          identifier: {validators: {notEmpty: {message: "用户名不可空"}}},
          password: {validators: {notEmpty: {message: "密码不可空"}}}
        }
      }).on("success.form.bv", function (e, t) {
        e.preventDefault(), c()
      })
    }, 0), t(function () {
      e.showLoginFormDelay = !0
    }, 1500)
  }])
}(), function (e) {
  "use strict";
  var t = angular.module("root");
  t.factory("navService", ["$http", function (e) {
    return {}
  }]), t.controller("NavCtrl", ["$scope", "navService", function (t, n) {
    var o = e('#mainnav-menu > li > a, #mainnav-menu-wrap .mainnav-widget a[data-toggle="menu-widget"]'), a = e("#mainnav").height(), c = null, r = !1, i = !1, u = null, s = function () {
      var t;
      o.each(function () {
        var n = e(this), a = n.children(".menu-title"), c = n.siblings(".collapse"), r = e(n.attr("data-target")), i = r.length ? r.parent() : null, u = null, s = null, l = null, d = null, p = (n.outerHeight() - n.height() / 4, function () {
          return r.length && n.on("click", function (e) {
            e.preventDefault()
          }), c.length ? (n.on("click", function (e) {
            e.preventDefault()
          }).parent("li").removeClass("active"), !0) : !1
        }()), f = null, g = function (e) {
          clearInterval(f), f = setInterval(function () {
            e.nanoScroller({preventPageScrolling: !0, alwaysVisible: !0}), clearInterval(f)
          }, 700)
        };
        e(document).click(function (t) {
          e(t.target).closest("#mainnav-container").length || n.removeClass("hover").popover("hide")
        }), e("#mainnav-menu-wrap > .nano").on("update", function (e, t) {
          n.removeClass("hover").popover("hide")
        }), n.popover({
          animation: !1,
          trigger: "manual",
          container: "#mainnav",
          viewport: n,
          html: !0,
          title: function () {
            return p ? a.html() : null
          },
          content: function () {
            var t;
            return p ? (t = e('<div class="sub-menu"></div>'), c.addClass("pop-in").wrap('<div class="nano-content"></div>').parent().appendTo(t)) : r.length ? (t = e('<div class="sidebar-widget-popover"></div>'), r.wrap('<div class="nano-content"></div>').parent().appendTo(t)) : t = '<span class="single-content">' + a.html() + "</span>", t
          },
          template: '<div class="popover menu-popover"><h4 class="popover-title"></h4><div class="popover-content"></div></div>'
        }).on("show.bs.popover", function () {
          if (!u) {
            if (u = n.data("bs.popover").tip(), s = u.find(".popover-title"), l = u.children(".popover-content"), !p && 0 == r.length)return;
            d = l.children(".sub-menu")
          }
          !p && 0 == r.length
        }).on("shown.bs.popover", function () {
          if (!p && 0 == r.length) {
            var t = 0 - .5 * n.outerHeight();
            return void l.css({"margin-top": t + "px", width: "auto"})
          }
          var o = parseInt(u.css("top")), a = n.outerHeight(), c = function () {
            return nifty.container.hasClass("mainnav-fixed") ? e(window).outerHeight() - o - a : e(document).height() - o - a
          }(), i = l.find(".nano-content").children().css("height", "auto").outerHeight();
          l.find(".nano-content").children().css("height", ""), o > c ? (s.length && !s.is(":visible") && (a = Math.round(0 - .5 * a)), o -= 5, l.css({
            top: "",
            bottom: a + "px",
            height: o
          }).children().addClass("nano").css({width: "100%"}).nanoScroller({preventPageScrolling: !0}), g(l.find(".nano"))) : (!nifty.container.hasClass("navbar-fixed") && nifty.mainNav.hasClass("affix-top") && (c -= 50), i > c ? ((nifty.container.hasClass("navbar-fixed") || nifty.mainNav.hasClass("affix-top")) && (c -= a + 5), c -= 5, l.css({
            top: a + "px",
            bottom: "",
            height: c
          }).children().addClass("nano").css({width: "100%"}).nanoScroller({preventPageScrolling: !0}), g(l.find(".nano"))) : (s.length && !s.is(":visible") && (a = Math.round(0 - .5 * a)), l.css({
            top: a + "px",
            bottom: "",
            height: "auto"
          }))), s.length && s.css("height", n.outerHeight()), l.on("click", function () {
            l.find(".nano-pane").hide(), g(l.find(".nano"))
          })
        }).on("hidden.bs.popover", function () {
          n.removeClass("hover"), p ? c.removeAttr("style").appendTo(n.parent()) : r.length && r.appendTo(i), clearInterval(t)
        }).on("click", function () {
          nifty.container.hasClass("mainnav-sm") && (o.popover("hide"), n.addClass("hover").popover("show"))
        }).hover(function () {
          o.popover("hide"), n.addClass("hover").popover("show")
        }, function () {
          clearInterval(t), t = setInterval(function () {
            u && (u.one("mouseleave", function () {
              n.removeClass("hover").popover("hide")
            }), u.is(":hover") || n.removeClass("hover").popover("hide")), clearInterval(t)
          }, 500)
        })
      }), i = !0
    }, l = function () {
      var t = e("#mainnav-menu").find(".collapse");
      t.length && t.each(function () {
        var t = e(this);
        t.hasClass("in") ? t.parent("li").addClass("active") : t.parent("li").removeClass("active")
      }), null != c && c.length && c.nanoScroller({stop: !0}), o.popover("destroy").unbind("mouseenter mouseleave"), i = !1
    }, d = function () {
      var t, n = nifty.container.width();
      t = 740 >= n ? "xs" : n > 740 && 992 > n ? "sm" : n >= 992 && 1200 >= n ? "md" : "lg", u != t && (u = t, nifty.screenSize = t, "sm" == nifty.screenSize && nifty.container.hasClass("mainnav-lg") && e.niftyNav("collapse"))
    }, p = function (t) {
      return nifty.mainNav.niftyAffix("update"), l(), d(), ("collapse" == r || nifty.container.hasClass("mainnav-sm")) && (nifty.container.removeClass("mainnav-in mainnav-out mainnav-lg"), s()), a = e("#mainnav").height(), r = !1, null
    }, f = {
      revealToggle: function () {
        nifty.container.hasClass("reveal") || nifty.container.addClass("reveal"), nifty.container.toggleClass("mainnav-in mainnav-out").removeClass("mainnav-lg mainnav-sm"), i && l()
      }, revealIn: function () {
        nifty.container.hasClass("reveal") || nifty.container.addClass("reveal"), nifty.container.addClass("mainnav-in").removeClass("mainnav-out mainnav-lg mainnav-sm"), i && l()
      }, revealOut: function () {
        nifty.container.hasClass("reveal") || nifty.container.addClass("reveal"), nifty.container.removeClass("mainnav-in mainnav-lg mainnav-sm").addClass("mainnav-out"), i && l()
      }, slideToggle: function () {
        nifty.container.hasClass("slide") || nifty.container.addClass("slide"), nifty.container.toggleClass("mainnav-in mainnav-out").removeClass("mainnav-lg mainnav-sm"), i && l()
      }, slideIn: function () {
        nifty.container.hasClass("slide") || nifty.container.addClass("slide"), nifty.container.addClass("mainnav-in").removeClass("mainnav-out mainnav-lg mainnav-sm"), i && l()
      }, slideOut: function () {
        nifty.container.hasClass("slide") || nifty.container.addClass("slide"), nifty.container.removeClass("mainnav-in mainnav-lg mainnav-sm").addClass("mainnav-out"), i && l()
      }, pushToggle: function () {
        nifty.container.toggleClass("mainnav-in mainnav-out").removeClass("mainnav-lg mainnav-sm"), nifty.container.hasClass("mainnav-in mainnav-out") && nifty.container.removeClass("mainnav-in"), i && l()
      }, pushIn: function () {
        nifty.container.addClass("mainnav-in").removeClass("mainnav-out mainnav-lg mainnav-sm"), i && l()
      }, pushOut: function () {
        nifty.container.removeClass("mainnav-in mainnav-lg mainnav-sm").addClass("mainnav-out"), i && l()
      }, colExpToggle: function () {
        return nifty.container.hasClass("mainnav-lg mainnav-sm") && nifty.container.removeClass("mainnav-lg"), nifty.container.toggleClass("mainnav-lg mainnav-sm").removeClass("mainnav-in mainnav-out"), nifty.window.trigger("resize")
      }, collapse: function () {
        return nifty.container.addClass("mainnav-sm").removeClass("mainnav-lg mainnav-in mainnav-out"), r = "collapse", nifty.window.trigger("resize")
      }, expand: function () {
        return nifty.container.removeClass("mainnav-sm mainnav-in mainnav-out").addClass("mainnav-lg"), nifty.window.trigger("resize")
      }, togglePosition: function () {
        nifty.container.toggleClass("mainnav-fixed"), nifty.mainNav.niftyAffix("update")
      }, fixedPosition: function () {
        nifty.container.addClass("mainnav-fixed"), nifty.mainNav.niftyAffix("update")
      }, staticPosition: function () {
        nifty.container.removeClass("mainnav-fixed"), nifty.mainNav.niftyAffix("update")
      }, update: p, forceUpdate: d, getScreenSize: function () {
        return u
      }
    };
    e.niftyNav = function (e, t) {
      if (f[e]) {
        ("colExpToggle" == e || "expand" == e || "collapse" == e) && ("xs" == nifty.screenSize && "collapse" == e ? e = "pushOut" : "xs" != nifty.screenSize && "sm" != nifty.screenSize || "colExpToggle" != e && "expand" != e || !nifty.container.hasClass("mainnav-sm") || (e = "pushIn"));
        var n = f[e].apply(this, Array.prototype.slice.call(arguments, 1));
        if (t)return t();
        if (n)return n
      }
      return null
    }, e.fn.isOnScreen = function () {
      var e = {top: nifty.window.scrollTop(), left: nifty.window.scrollLeft()};
      e.right = e.left + nifty.window.width(), e.bottom = e.top + nifty.window.height();
      var t = this.offset();
      return t.right = t.left + this.outerWidth(), t.bottom = t.top + this.outerHeight(), !(e.right < t.left || e.left > t.right || e.bottom < t.bottom || e.top > t.top)
    }, nifty.window.on("resizeEnd", p).trigger("resize");
    var g = e(".mainnav-toggle");
    g.length && g.on("click", function (t) {
      t.preventDefault(), e.niftyNav(g.hasClass("push") ? "pushToggle" : g.hasClass("slide") ? "slideToggle" : g.hasClass("reveal") ? "revealToggle" : "colExpToggle")
    });
    var h = e("#mainnav-menu");
    h.length && (h.metisMenu({toggle: !0}), c = nifty.mainNav.find(".nano"), c.length && c.nanoScroller({preventPageScrolling: !0}));
    var m = {};
    e("#mainnav").find("#mainnav-menu").find(">li").each(function (t, n) {
      var o = e(n), a = o.find(">a").attr("href"), c = {$html: o};
      a && (m[a] = c), o.find(">ul>li").each(function (t, n) {
        var o = e(n), a = o.find(">a").attr("href");
        a && (m[a] = {$html: o, parent: c})
      })
    }), t.$on("$routeChangeSuccess", function (t, n, o) {
      var a = e("#mainnav");
      a.find("li.active-link").removeClass("active-link"), a.find("li.active-sub").removeClass("active-sub");
      var c = n.$$route ? n.$$route.originalPath : "/dashboard", r = m["#" + c];
      r && (r.$html.addClass("active-link"), r.parent && (r.parent.$html.addClass("active-sub"), r.$html.parent("ul.collapse").addClass("in"))), !function (e) {
        var t, n = function (t) {
          if (!t.data("nifty-check")) {
            t.data("nifty-check", !0), t.text().trim().length ? t.addClass("form-text") : t.removeClass("form-text");
            var n = t.find("input")[0], o = n.name, a = function () {
              return "radio" == n.type && o ? e(".form-radio").not(t).find("input").filter("input[name=" + o + "]").parent() : !1
            }(), c = function () {
              "radio" == n.type && a.length && a.each(function () {
                var t = e(this);
                t.hasClass("active") && t.trigger("nifty.ch.unchecked"), t.removeClass("active")
              }), n.checked ? t.addClass("active").trigger("nifty.ch.checked") : t.removeClass("active").trigger("nifty.ch.unchecked")
            };
            n.checked ? t.addClass("active") : t.removeClass("active"), e(n).on("change", c)
          }
        }, o = {
          isChecked: function () {
            return this[0].checked
          }, toggle: function () {
            return this[0].checked = !this[0].checked, this.trigger("change"), null
          }, toggleOn: function () {
            return this[0].checked || (this[0].checked = !0, this.trigger("change")), null
          }, toggleOff: function () {
            return this[0].checked && "checkbox" == this[0].type && (this[0].checked = !1, this.trigger("change")), null
          }
        };
        e.fn.niftyCheck = function (t) {
          var a = !1;
          return this.each(function () {
            o[t] ? a = o[t].apply(e(this).find("input"), Array.prototype.slice.call(arguments, 1)) : "object" != typeof t && t || n(e(this))
          }), a
        }, nifty.document.ready(function () {
          t = e(".form-checkbox, .form-radio"), t.length && t.niftyCheck()
        }), nifty.document.on("change", ".btn-file :file", function () {
          var t = e(this), n = t.get(0).files ? t.get(0).files.length : 1, o = t.val().replace(/\\/g, "/").replace(/.*\//, ""), a = function () {
            try {
              return t[0].files[0].size
            } catch (e) {
              return "Nan"
            }
          }(), c = function () {
            if ("Nan" == a)return "Unknown";
            var e = Math.floor(Math.log(a) / Math.log(1024));
            return 1 * (a / Math.pow(1024, e)).toFixed(2) + " " + ["B", "kB", "MB", "GB", "TB"][e]
          }();
          t.trigger("fileselect", [n, o, c])
        })
      }(jQuery)
    })
  }])
}(jQuery), function () {
  var e = angular.module("root");
  e.factory("accountManageService", ["$http", function (e) {
    return {
      getAccounts: function (t, n, o) {
        return e.get("/api/account?" + t.toString()).success(n), this
      }, createAccount: function (t, n, o) {
        return e.post("/api/account", t).success(n).error(o), this
      }, getCurrentOrgGroups: function (t) {
        var n = "/api/group";
        return e.get(n).success(t), this
      }, getCurrentAccountGroups: function (t, n) {
        var o = "/api/account/" + t + "/group";
        return e.get(o).success(n), this
      }, addAccountsToGroup: function (t, n, o, a) {
        var c = "/api/account/" + t + "/group";
        return e.put(c, n).success(o).error(a), this
      }, authAccount: function (t, n, o, a) {
        var c = "/api/account/" + t + "/accountpermissionpolicy";
        return e.post(c, n).success(o).error(a), this
      }, cancelAuthAccount: function (t, n, o, a) {
        var c = "/api/account/" + t + "/accountpermissionpolicy?policy_code=" + n;
        return e["delete"](c).success(o).error(a), this
      }, getAccountAllPermissions: function (t, n, o) {
        var a = "/api/account/" + t + "/permission";
        e.get(a).success(n)
      }
    }
  }]), e.controller("AccountManageCtrl", ["$scope", "$timeout", "accountManageService", "YUNSOO_CONFIG", function (e, t, n, o) {
    var a = o.PAGE_ACCESS.RESOURCE, c = o.PAGE_ACCESS.ACTION, r = e.accountPermission = {
      dashBoardRead: "",
      productKeyRead: "",
      productKeyMng: "",
      packageRead: "",
      packageMng: "",
      logisticsRead: "",
      logisticsMng: "",
      reportRead: "",
      productRead: "",
      productMng: "",
      msgRead: "",
      msgMng: "",
      deviceRead: "",
      deviceMng: "",
      accountRead: "",
      accountMng: "",
      groupRead: "",
      groupMng: "",
      passwordRead: ""
    }, i = {
      sortable: {target: "#sort-bar", sort: "createdDateTime,desc"},
      pageable: {page: 0, size: 20},
      flush: function (e) {
        n.getAccounts(this, function (t, n, o) {
          e({data: t, headers: o})
        })
      }
    };
    t(function () {
      $("#accountForm").bootstrapValidator({
        message: "输入不合法",
        feedbackIcons: {
          valid: "fa fa-check-circle fa-lg text-success",
          invalid: "fa fa-times-circle fa-lg",
          validating: "fa fa-refresh"
        },
        fields: {
          accountIdentifier: {container: "tooltip", validators: {notEmpty: {message: "请输入账号标识"}}},
          lastName: {container: "tooltip", validators: {notEmpty: {message: "请输入姓"}}},
          firstName: {container: "tooltip", validators: {notEmpty: {message: "请输入名"}}},
          email: {container: "tooltip", validators: {notEmpty: {message: "请输入邮箱"}, emailAddress: {message: "邮箱输入不合法"}}},
          phone: {container: "tooltip", validators: {notEmpty: {message: "请输入电话"}, digits: {message: "电话只能是数字"}}},
          password: {container: "tooltip", validators: {notEmpty: {message: "请输入密码"}}},
          passwordConfirm: {
            container: "tooltip",
            validators: {notEmpty: {message: "请输入确认密码"}, identical: {field: "password", message: "确认密码不一致"}}
          }
        }
      }).on("success.field.bv", function (e, t) {
      })
    }, 0), n.getCurrentOrgGroups(function (e) {
      u.curOrgGroups = e
    });
    var u = e.account = {
      spinnerShow: !1,
      accountTable: new e.utils.DataTable(i),
      selectAccount: "",
      curOrgGroups: "",
      curSelectedGroups: [],
      create: {
        accountIdentifier: "",
        lastName: "",
        firstName: "",
        email: "",
        phone: "",
        password: "",
        passwordConfirm: "",
        createAccount: function () {
          if ("" != u.create.accountIdentifier && "" != u.create.firstName && "" != u.create.lastName && "" != u.create.email && "" != u.create.phone && "" != u.create.password) {
            var t = {};
            t.org_id = e.context.organization.id, t.identifier = u.create.accountIdentifier, t.first_name = u.create.firstName, t.last_name = u.create.lastName, t.email = u.create.email, t.phone = u.create.phone, t.password = u.create.password, u.spinnerShow = !0, n.createAccount(t, function (t) {
              u.spinnerShow = !1, $("#createAccountModal").modal("hide"), e.utils.alert("success", "创建账号成功"), u.accountTable = new e.utils.DataTable(i)
            }, function (t) {
              u.spinnerShow = !1, e.utils.alert("danger", "创建账号失败", "#createAccountModal .modal-dialog", !1)
            })
          }
        },
        showCreateAccountModal: function () {
          $("#createAccountModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
            $(this).removeData("bs.modal")
          })
        },
        hideCreateAccountModal: function () {
          u.spinnerShow = !1, $("#createAccountModal").modal("hide")
        }
      },
      auth: {
        disableAll: !1, checkAllAccess: function (e) {
          r.dashBoardRead = e, r.productKeyRead = e, r.productKeyMng = e, r.packageRead = e, r.packageMng = e, r.logisticsRead = e, r.logisticsMng = e, r.reportRead = e, r.productRead = e, r.productMng = e, r.msgRead = e, r.msgMng = e, r.deviceRead = e, r.deviceMng = e, r.accountRead = e, r.accountMng = e, r.groupRead = e, r.groupMng = e, r.passwordRead = e
        }, authDashBoardRead: function () {
          r.dashBoardRead ? n.authAccount(u.selectAccount, {policy_code: a.DASHBOARD + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.DASHBOARD + ":" + c.READ, function () {
          }, function () {
          })
        }, authProductKeyRead: function () {
          r.productKeyRead ? n.authAccount(u.selectAccount, {policy_code: a.PRODUCTKEY + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PRODUCTKEY + ":" + c.READ, function () {
          }, function () {
          })
        }, authProductKeyMng: function () {
          r.productKeyMng ? n.authAccount(u.selectAccount, {policy_code: a.PRODUCTKEY + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PRODUCTKEY + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authPackageRead: function () {
          r.packageRead ? n.authAccount(u.selectAccount, {policy_code: a.PACKAGE + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PACKAGE + ":" + c.READ, function () {
          }, function () {
          })
        }, authPackageMng: function () {
          r.packageMng ? n.authAccount(u.selectAccount, {policy_code: a.PACKAGE + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PACKAGE + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authLogisticsRead: function () {
          r.logisticsRead ? n.authAccount(u.selectAccount, {policy_code: a.LOGISTICS + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.LOGISTICS + ":" + c.READ, function () {
          }, function () {
          })
        }, authLogisticsMng: function () {
          r.logisticsMng ? n.authAccount(u.selectAccount, {policy_code: a.LOGISTICS + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.LOGISTICS + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authReportRead: function () {
          r.reportRead ? n.authAccount(u.selectAccount, {policy_code: a.REPORT + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.REPORT + ":" + c.READ, function () {
          }, function () {
          })
        }, authProductRead: function () {
          r.productRead ? n.authAccount(u.selectAccount, {policy_code: a.PRODUCTBASE + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PRODUCTBASE + ":" + c.READ, function () {
          }, function () {
          })
        }, authProductMng: function () {
          r.productMng ? n.authAccount(u.selectAccount, {policy_code: a.PRODUCTBASE + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PRODUCTBASE + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authMsgRead: function () {
          r.msgRead ? n.authAccount(u.selectAccount, {policy_code: a.MESSAGE + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.MESSAGE + ":" + c.READ, function () {
          }, function () {
          })
        }, authMsgMng: function () {
          r.msgMng ? n.authAccount(u.selectAccount, {policy_code: a.MESSAGE + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.MESSAGE + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authDeviceRead: function () {
          r.deviceRead ? n.authAccount(u.selectAccount, {policy_code: a.DEVICE + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.DEVICE + ":" + c.READ, function () {
          }, function () {
          })
        }, authDeviceMng: function () {
          r.deviceMng ? n.authAccount(u.selectAccount, {policy_code: a.DEVICE + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.DEVICE + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authAccountRead: function () {
          r.accountRead ? n.authAccount(u.selectAccount, {policy_code: a.ACCOUNT + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.ACCOUNT + ":" + c.READ, function () {
          }, function () {
          })
        }, authAccountMng: function () {
          r.accountMng ? n.authAccount(u.selectAccount, {policy_code: a.ACCOUNT + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.ACCOUNT + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authGroupRead: function () {
          r.groupRead ? n.authAccount(u.selectAccount, {policy_code: a.GROUP + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.GROUP + ":" + c.READ, function () {
          }, function () {
          })
        }, authGroupMng: function () {
          r.groupMng ? n.authAccount(u.selectAccount, {policy_code: a.GROUP + ":" + c.MANAGE}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.GROUP + ":" + c.MANAGE, function () {
          }, function () {
          })
        }, authPasswordRead: function () {
          r.passwordRead ? n.authAccount(u.selectAccount, {policy_code: a.PROFILE + ":" + c.READ}, function () {
          }, function () {
          }) : n.cancelAuthAccount(u.selectAccount, a.PROFILE + ":" + c.READ, function () {
          }, function () {
          })
        }, showAuthAccountModal: function (e) {
          u.selectAccount = e, u.auth.checkAllAccess(!1), u.auth.disableAll = !1, n.getAccountAllPermissions(e, function (e) {
            for (var t = 0; t < e.length; t++) {
              if ("*" == e[t].resource_code && "*" == e[t].action_code) {
                u.auth.disableAll = !0, u.auth.checkAllAccess(!0);
                break
              }
              e[t].resource_code == a.DASHBOARD && e[t].action_code == c.READ && (r.dashBoardRead = !0), e[t].resource_code == a.PRODUCTKEY && e[t].action_code == c.READ && (r.productKeyRead = !0), e[t].resource_code == a.PRODUCTKEY && e[t].action_code == c.MANAGE && (r.productKeyMng = !0), e[t].resource_code == a.PACKAGE && e[t].action_code == c.READ && (r.packageRead = !0), e[t].resource_code == a.PACKAGE && e[t].action_code == c.MANAGE && (r.packageMng = !0), e[t].resource_code == a.LOGISTICS && e[t].action_code == c.READ && (r.logisticsRead = !0), e[t].resource_code == a.LOGISTICS && e[t].action_code == c.MANAGE && (r.logisticsMng = !0), e[t].resource_code == a.REPORT && e[t].action_code == c.READ && (r.reportRead = !0), e[t].resource_code == a.PRODUCTBASE && e[t].action_code == c.READ && (r.productRead = !0), e[t].resource_code == a.PRODUCTBASE && e[t].action_code == c.MANAGE && (r.productMng = !0), e[t].resource_code == a.MESSAGE && e[t].action_code == c.READ && (r.msgRead = !0), e[t].resource_code == a.MESSAGE && e[t].action_code == c.MANAGE && (r.msgMng = !0), e[t].resource_code == a.DEVICE && e[t].action_code == c.READ && (r.deviceRead = !0), e[t].resource_code == a.DEVICE && e[t].action_code == c.MANAGE && (r.deviceMng = !0), e[t].resource_code == a.ACCOUNT && e[t].action_code == c.READ && (r.accountRead = !0), e[t].resource_code == a.ACCOUNT && e[t].action_code == c.MANAGE && (r.accountMng = !0), e[t].resource_code == a.GROUP && e[t].action_code == c.READ && (r.groupRead = !0), e[t].resource_code == a.GROUP && e[t].action_code == c.MANAGE && (r.groupMng = !0), e[t].resource_code == a.PROFILE && e[t].action_code == c.READ && (r.passwordRead = !0)
            }
            $("#treeMenuModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
              $(this).removeData("bs.modal")
            })
          })
        }, hideAuthAccountModal: function () {
          u.selectAccount = "", $("#treeMenuModal").modal("hide")
        }
      },
      assignGroup: {
        showAddToGroupModal: function (e) {
          u.selectAccount = e, n.getCurrentAccountGroups(e, function (e) {
            "" != u.curOrgGroups && $.each(u.curOrgGroups, function (t, n) {
              var o = "<option value=" + n.id;
              void 0 != e && e.length > 0 && $.each(e, function (e, t) {
                t.id == n.id && (o += " selected = 'selected'")
              }), o += ">" + n.name + "</option>", $("#selectGroup").append(o)
            }), $("#selectGroup").chosen({width: "100%"}), $("#selectGroup").change(function () {
              u.curSelectedGroups = $(this).val()
            }), $("#addToGroupModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
              $(this).removeData("bs.modal")
            })
          }, function () {
            "" != u.curOrgGroups && $.each(u.curOrgGroups, function (e, t) {
              var n = "<option value=" + t.id + ">" + t.name + "</option>";
              $("#selectGroup").append(n)
            }), $("#selectGroup").chosen({width: "100%"}), $("#selectGroup").change(function () {
              u.curSelectedGroups = $(this).val()
            }), $("#addToGroupModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
              $(this).removeData("bs.modal")
            })
          })
        }, hideAddAccountsModal: function () {
          u.spinnerShow = !1, u.curSelectedGroups = [], $("#selectGroup").chosen("destroy"), $("#selectGroup").html(""), $("#addToGroupModal").modal("hide")
        }, addAccountsToGroup: function () {
          u.spinnerShow = !0, "" != u.curSelectedGroups && n.addAccountsToGroup(u.selectAccount, u.curSelectedGroups || [], function (t) {
            u.assignGroup.hideAddAccountsModal(), e.utils.alert("info", "账号组更新成功")
          }, function (t) {
            u.spinnerShow = !1, e.utils.alert("danger", "账号组更新失败", "#addToGroupModal .modal-dialog", !1)
          })
        }
      }
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("dashboardService", ["$http", function (e) {
    return {
      getProductKeyQuantitySum: function (t) {
        e.get("/api/productkeybatch/sum/quantity").success(t)
      }, getUnVerifiedMessages: function (t, n) {
        e.get("/api/message/count/on?" + t).success(n)
      }, getAllMessages: function (t, n) {
        e.get("/api/message/count/on?" + t).success(n)
      }
    }
  }]), e.controller("DashboardCtrl", ["$scope", "dashboardService", "$timeout", function (e, t, n) {
    function o() {
      t.getUnVerifiedMessages("org_id=" + e.context.organization.id + "&status_code_in=created", function (n) {
        var o = n;
        t.getAllMessages("org_id=" + e.context.organization.id, function (e) {
          var t = e, n = Math.round(o / t * 100);
          $("#maChart02").empty(), $("#maChart02").data("text", o), $("#maChart02").data("percent", n), $("#maChart02").circliful(), $("#maChart02 .circle-info-half").css("padding-top", "5px")
        })
      })
    }

    function a(e) {
      $("#maChart04").empty(),
          $("#maChart04").data("text", c(e.remain)), $("#maChart04").data("percent", e.percentage), $("#maChart04").circliful(), $("#maChart04 .circle-info-half").css("padding-top", "5px")
    }

    e.productKeyQuantitySum = 0, t.getProductKeyQuantitySum(function (t) {
      e.productKeyQuantitySum = t
    });
    var c = e.Conversion = function (e) {
      return isNaN(e) ? "这不是一个数字" : 0 > e ? "这是一个负数" : e >= 0 && 1e4 > e ? e + "" : e >= 1e4 && 1e8 > e ? e % 1e4 == 0 ? e / 1e4 + "万" : parseInt(e / 1e4) + "万+" : e >= 1e8 ? e % 1e8 == 0 ? e / 1e8 + "亿" : parseInt(e / 1e8) + "亿+" : void 0
    };
    e.$on("$routeChangeSuccess", function (t, n, c) {
      var r = n.$$route ? n.$$route.originalPath : "/dashboard";
      "/dashboard" === r && ($("#maChart01").circliful(), $("#maChart02").circliful(), $("#maChart03").circliful(), $("#maChart04").circliful(), $("#maChart01 .circle-info-half").css("padding-top", "5px"), $("#maChart02 .circle-info-half").css("padding-top", "5px"), $("#maChart03 .circle-info-half").css("padding-top", "5px"), $("#maChart04 .circle-info-half").css("padding-top", "5px"), e.context.organization ? o() : e.$on("context-organization-ready", function (e) {
        o()
      }), e.productKeyCreditSum && e.productKeyCreditSum.ready ? a(e.productKeyCreditSum) : e.$on("productKeyCreditSum-ready", function (e, t) {
        a(t)
      }))
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("deviceService", ["$http", function (e) {
    return {
      getCurrentOrgDevices: function (t, n) {
        var o = "/api/device?" + t.toString();
        return e.get(o).success(n), this
      }, getCurrentOrgAccounts: function (t) {
        var n = "/api/account";
        return e.get(n).success(t), this
      }, getDeviceAuthToken: function (t, n, o) {
        var a = "/api/auth/logintoken?account_id=" + t;
        return e.get(a).success(n).error(o), this
      }, createAccount: function (t, n, o) {
        return e.post("/api/account", t).success(n).error(o), this
      }
    }
  }]), e.controller("deviceCtrl", ["$scope", "deviceService", "$timeout", function (e, t, n) {
    function o(e) {
      var t, n, o, a;
      for (t = "", o = e.length, n = 0; o > n; n++)a = e.charCodeAt(n), a >= 1 && 127 >= a ? t += e.charAt(n) : a > 2047 ? (t += String.fromCharCode(224 | a >> 12 & 15), t += String.fromCharCode(128 | a >> 6 & 63), t += String.fromCharCode(128 | a >> 0 & 63)) : (t += String.fromCharCode(192 | a >> 6 & 31), t += String.fromCharCode(128 | a >> 0 & 63));
      return t
    }

    var a = null;
    t.getCurrentOrgAccounts(function (e) {
      c.account.curOrgAccounts = e
    }), n(function () {
      $("#createForm").bootstrapValidator({
        message: "输入不合法",
        feedbackIcons: {
          valid: "fa fa-check-circle fa-lg text-success",
          invalid: "fa fa-times-circle fa-lg",
          validating: "fa fa-refresh"
        },
        fields: {
          accountIdentifier: {container: "tooltip", validators: {notEmpty: {message: "请输入账号标识"}}},
          accountPassword: {container: "tooltip", validators: {notEmpty: {message: "请输入账号密码"}}},
          accountPasswordConfirm: {
            container: "tooltip",
            validators: {notEmpty: {message: "请输入确认密码"}, identical: {field: "accountPassword", message: "确认密码不一致"}}
          }
        }
      }).on("success.field.bv", function (t, n) {
        c.account.createEnabled = !1, e.$apply()
      })
    }, 0);
    var c = e.device = {
      account: {
        curOrgAccounts: "",
        showCreateAccount: !1,
        createEnabled: !0,
        accountIdentifier: "",
        accountPassword: "",
        accountPasswordConfirm: "",
        spinnerShow: !1,
        createAccount: function () {
          if ("" != c.account.accountIdentifier && "" != c.account.accountPassword && "" != c.account.accountPasswordConfirm) {
            c.account.spinnerShow = !0;
            var n = {};
            n.org_id = e.context.organization.id, n.identifier = c.account.accountIdentifier, n.password = c.account.accountPassword, n.first_name = "设备", n.last_name = "设备", n.email = "device@device.com", n.phone = "111", t.createAccount(n, function (n) {
              c.account.spinnerShow = !1, e.utils.alert("success", "创建账号成功", "#myModal .modal-dialog", !1), t.getCurrentOrgAccounts(function (e) {
                c.account.curOrgAccounts = e
              }), c.account.showCreateAccount = !1
            }, function (t) {
              c.account.spinnerShow = !1, e.utils.alert("danger", "创建账号失败", "#myModal .modal-dialog", !1)
            })
          }
        },
        cancelAccount: function () {
          c.account.showCreateAccount = !1, c.account.spinnerShow = !1
        }
      },
      deviceTable: new e.utils.DataTable({
        sortable: {target: "#sort-bar", sort: "createdDateTime,desc"},
        pageable: {page: 0, size: 20},
        flush: function (e) {
          t.getCurrentOrgDevices(this, function (t, n, o) {
            e({data: t, headers: o})
          })
        }
      }),
      time_distance: 0,
      deviceComment: "",
      deviceName: "",
      selectAccount: "",
      deviceAuth: function () {
        if ("" == c.selectAccount)return void $("#divSelectAccount").addClass("has-error").addClass("has-feedback");
        if ("" == c.deviceName)return void $("#divDeviceName").addClass("has-error").addClass("has-feedback");
        if (c.deviceComment.length > 20)return void $("#divDeviceComment").addClass("has-error").addClass("has-feedback");
        $("#divDeviceName").addClass("has-success").addClass("has-feedback"), $("#divSelectAccount").addClass("has-success").addClass("has-feedback"), $("#divDeviceComment").addClass("has-success").addClass("has-feedback");
        var n = function (t) {
          var n = {};
          n.a = e.context.account.id, n.t = t.token, n.dn = c.deviceName, n.dc = c.deviceComment;
          var a = JSON.stringify(n);
          $("#authQRCode").html(""), e.qrcode = $("#authQRCode").qrcode({
            render: "canvas",
            width: 300,
            height: 300,
            foreground: "#337ab7",
            correctLevel: 3,
            text: o(a)
          })
        };
        c.time_distance = 120, null == a && (a = setInterval(function () {
          c.time_distance--;
          var o = Math.floor(c.time_distance / 60), r = Math.floor(c.time_distance - 60 * o);
          10 > o && (o = "0" + o), 10 > r && (r = "0" + r), $("#time_refresh").html("设备授权码将在" + o + "分" + r + "秒内刷新"), 0 == c.time_distance && (c.time_distance = 120, t.getDeviceAuthToken(c.selectAccount, n, function () {
            $("#time_refresh").html(""), clearInterval(a), a = null, $("#authQRCode").html(""), e.utils.alert("danger", "获取账号Token失败", "#myModal .modal-dialog", !1)
          }))
        }, 1e3)), setTimeout(function () {
          clearInterval(a)
        }, 12e5), t.getDeviceAuthToken(c.selectAccount, n, function () {
          $("#time_refresh").html(""), clearInterval(a), a = null, $("#authQRCode").html(""), e.utils.alert("danger", "获取账号Token失败", "#myModal .modal-dialog", !1)
        })
      },
      cancelDeviceAuth: function () {
        e.utils.alert("info", "设备取消授权正在开发中")
      },
      showDeviceModal: function () {
        $("#myModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
          $(this).removeData("bs.modal")
        })
      },
      hideDeviceModal: function () {
        c.account.spinnerShow = !1, $("#myModal").modal("hide")
      }
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("echartsBarService", ["$http", function (e) {
    return {
      getQRCode: function (t, n, o) {
        var a = "/api/report/myorganization/product_qrcode_count/" + t;
        return e.get(a).success(n).error(o), this
      }
    }
  }]), e.controller("echartsBarCtrl", ["$scope", "echartsBarService", "$timeout", function (e, t, n) {
    function o(e, n, o) {
      t.getQRCode(a.getDateStr(e, n, o), c, function () {
        var e = {};
        e.data = [], e.dimensions = {}, e.dimensions.values = [], c(e)
      })
    }

    var a = e.dataTable = new e.utils.DateHelp(o), c = function (e) {
      var t = echarts.init($("#echartBar")[0]), n = {
        title: {text: "产品贴码统计"},
        tooltip: {trigger: "axis"},
        legend: {data: ["产品贴码统计"]},
        toolbox: {
          show: !0,
          feature: {
            mark: {show: !0},
            dataView: {show: !0, readOnly: !1},
            magicType: {show: !0, type: ["line", "bar"]},
            restore: {show: !0},
            saveAsImage: {show: !0}
          }
        },
        calculable: !0,
        xAxis: [{type: "category", show: !0, data: e.dimensions.values}],
        yAxis: [{type: "value"}],
        series: [{name: "产品贴码统计", type: "bar", data: e.data}]
      };
      t.setOption(n)
    };
    t.getQRCode(a.getDateStr(), c, function () {
      var e = {};
      e.data = [], e.dimensions = {}, e.dimensions.values = [], c(e)
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("mixMapService", ["$http", function (e) {
    return {
      getLocationCount: function (t, n, o) {
        var a = "/api/report/myorganization/location_scan_count/" + t;
        return e.get(a).success(n).error(o), this
      }
    }
  }]), e.controller("mixMapCtrl", ["$scope", "mixMapService", "$timeout", function (e, t, n) {
    function o(e, n, o) {
      t.getLocationCount(c.getDateStr(e, n, o), a, function () {
        var e = {};
        e.data = [], e.dimensions = {}, e.dimensions.values = [], a(e)
      })
    }

    function a(e) {
      for (var t = echarts.init($("#mixMap")[0]), n = [], o = 0; o < e.data.length; o++)n.push({
        name: e.dimensions.values[o].replace("市", "").replace("省", "").replace("自治区", ""),
        value: e.data[o]
      });
      var a = {
        title: {text: "产品地域统计"},
        tooltip: {trigger: "item"},
        legend: {x: "right", selectedMode: !1, data: e.dimensions.values},
        dataRange: {orient: "horizontal", min: 0, max: 55e3, text: ["高", "低"], splitNumber: 0},
        toolbox: {
          show: !0,
          orient: "vertical",
          x: "right",
          y: "center",
          feature: {mark: {show: !0}, dataView: {show: !0, readOnly: !1}}
        },
        series: [{
          name: "产品地域统计",
          type: "map",
          mapType: "china",
          mapLocation: {x: "left"},
          selectedMode: "multiple",
          itemStyle: {normal: {label: {show: !0}}, emphasis: {label: {show: !0}}},
          data: n
        }, {
          name: "产品地域统计",
          type: "pie",
          roseType: "area",
          tooltip: {trigger: "item", formatter: "{a} <br/>{b} : {c} ({d}%)"},
          center: [$("#mixMap")[0].offsetWidth - 250, 225],
          radius: [30, 120],
          data: n
        }],
        animation: !1
      }, c = echarts.config;
      t.on(c.EVENT.MAP_SELECTED, function (e) {
        for (var n, o = e.selected, c = a.series[0], r = [], i = [], u = 0, s = c.data.length; s > u; u++)n = c.data[u].name, o[n] && (r.push({
          name: n,
          value: c.data[u].value
        }), i.push(n));
        a.legend.data = i, a.series[1].data = r, t.setOption(a, !0)
      }), t.setOption(a)
    }

    var c = e.dataTable = new e.utils.DateHelp(o);
    t.getLocationCount(c.getDateStr(), a, function () {
      var e = {};
      e.data = [], e.dimensions = {}, e.dimensions.values = [], a(e)
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("pieMapService", ["$http", function (e) {
    return {
      getScanCount: function (t, n, o) {
        var a = "/api/report/myorganization/product_scan_count/" + t;
        return e.get(a).success(n).error(o), this
      }
    }
  }]), e.controller("pieMapCtrl", ["$scope", "pieMapService", "$timeout", function (e, t, n) {
    function o(e, n, o) {
      t.getScanCount(c.getDateStr(e, n, o), a, function () {
        var e = {};
        e.data = [], e.dimensions = {}, e.dimensions.values = [], a(e)
      })
    }

    function a(e) {
      for (var t = echarts.init($("#pieMap")[0]), n = [], o = 0; o < e.data.length; o++)n.push({
        value: e.data[o],
        name: e.dimensions.values[o]
      });
      var a = {
        title: {text: "产品扫码统计", x: "center"},
        tooltip: {trigger: "item", formatter: "{a} <br/>{b} : {c} ({d}%)"},
        legend: {orient: "vertical", x: "left", data: e.dimensions.values},
        toolbox: {
          show: !0,
          feature: {
            mark: {show: !0},
            dataView: {show: !0, readOnly: !1},
            magicType: {
              show: !0,
              type: ["pie", "funnel"],
              option: {funnel: {x: "25%", width: "50%", funnelAlign: "left", max: 1548}}
            },
            restore: {show: !0},
            saveAsImage: {show: !0}
          }
        },
        calculable: !0,
        series: [{name: "扫码统计", type: "pie", radius: "55%", center: ["50%", "60%"], data: n}]
      };
      t.setOption(a)
    }

    var c = e.dataTable = new e.utils.DateHelp(o);
    t.getScanCount(c.getDateStr(), a, function () {
      var e = {};
      e.data = [], e.dimensions = {}, e.dimensions.values = [], a(e)
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("stackedBarService", ["$http", function (e) {
    return {
      getScanCount: function (t, n, o) {
        var a = "/api/report/myorganization/product_month_scan_count/" + t;
        return e.get(a).success(n).error(o), this
      }
    }
  }]), e.controller("stackedBarCtrl", ["$scope", "stackedBarService", "$timeout", function (e, t, n) {
    function o(e, n, o) {
      t.getScanCount(c.getDateStr(e, n, o), a, function () {
        var e = {};
        e.data = [], e.dimensions = {}, e.dimensions.values = [], e.dimensions.values.push([]), e.dimensions.values.push([]), a(e)
      })
    }

    function a(e) {
      var t = echarts.init($("#stackedBar")[0]), n = [];
      if (0 == e.data.length)n.push({}); else for (var o = 0; o < e.data.length; o++) {
        for (var a = 0; a < e.data[o].length; a++)null == e.data[o][a] && (e.data[o][a] = 0);
        n.push({
          name: e.dimensions.values[0][o],
          type: "bar",
          stack: "总量",
          itemStyle: {normal: {label: {show: !0, position: "insideRight"}}},
          data: e.data[o]
        })
      }
      var c = {
        title: {text: "产品扫码月统计"},
        tooltip: {trigger: "axis", axisPointer: {type: "shadow"}},
        legend: {orient: "vertical", x: "right", y: "center", data: e.dimensions.values[0]},
        toolbox: {
          show: !0,
          feature: {
            mark: {show: !0},
            dataView: {show: !0, readOnly: !1},
            magicType: {show: !0, type: ["line", "bar", "stack", "tiled"]},
            restore: {show: !0},
            saveAsImage: {show: !0}
          }
        },
        calculable: !0,
        xAxis: [{type: "value"}],
        yAxis: [{type: "category", show: !0, data: e.dimensions.values[1]}],
        series: n
      };
      t.setOption(c)
    }

    var c = e.dataTable = new e.utils.DateHelp(o);
    t.getScanCount(c.getDateStr(), a, function () {
      var e = {};
      e.data = [], e.dimensions = {}, e.dimensions.values = [], e.dimensions.values.push([]), e.dimensions.values.push([]), a(e)
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.value("ProductDetailsVersion", "1.0"), e.factory("emulatorService", ["$http", function (e) {
    return {
      createProWithDetail: function (t, n, o) {
        return e.post("/api/productbase/withdetail", t).success(n).error(o), this
      }
    }
  }]), e.controller("emulatorCtrl", ["$scope", "emulatorService", "$timeout", "FileUploader", "$location", "ProductDetailsVersion", function (e, t, n, o, a, c) {
    var r = e.uploader = new o({url: ""}), i = e.utils.auth.getAccessToken();
    i && (r.headers[e.YUNSOO_CONFIG.HEADER_ACCESS_TOKEN] = i), e.fileInput = "";
    var u = e.product = {
      productInfos: [{key: "", value: ""}],
      productAddress: [{address: "", tel: ""}],
      productCommerce: [{title: "", url: ""}],
      barCode: "",
      productName: "",
      expireDate: 1,
      expireDateUnitValue: [{key: "year", value: "年"}, {key: "month", value: "月"}, {
        key: "week",
        value: "周"
      }, {key: "day", value: "天"}, {key: "hour", value: "时"}],
      expireDateUnit: "",
      comment: "",
      keyTypePubInput: "",
      keyTypePriInput: "",
      keyTypeRFIDInput: "",
      hotline: "",
      support: "",
      proPicPreview: !1,
      addProductInfo: function () {
        this.productInfos.push({key: "", value: ""})
      },
      subProductInfo: function () {
        this.productInfos.pop()
      },
      addProAddress: function () {
        this.productAddress.push({address: "", tel: ""})
      },
      subProAddress: function () {
        this.productAddress.pop()
      },
      addProductCommerce: function () {
        this.productCommerce.push({title: "", url: ""})
      },
      subProductCommerce: function () {
        this.productCommerce.pop()
      }
    };
    e.preview = function () {
      var t = {};
      t.orgImgUrl = "/api/organization/" + e.context.organization.id + "/logo-mobile?access_token=" + e.utils.auth.getAccessToken(), t.proImgUrl = e.fileInput, t.barcode = u.barCode, t.name = u.productName, t.details = u.productInfos, $("#iphone-6-portrait")[0].contentWindow.refresh(t)
    }, e.submit = function (n) {
      if (!n)return void e.utils.alert("info", "页面验证有错误，请返回检查");
      if (!u.keyTypePubInput && !u.keyTypePriInput && !u.keyTypeRFIDInput)return void e.utils.alert("info", "产品码类型至少要选择一种");
      if ("" == u.expireDateUnit)return void e.utils.alert("info", "请选择产品过期单位");
      if (0 == r.queue.length)return void e.utils.alert("info", "产品图片不能为空");
      var o = {};
      o.category_id = 0, o.barcode = u.barCode, o.name = u.productName, o.comments = u.comment, o.product_key_type_codes = [], u.keyTypePubInput && o.product_key_type_codes.push("qr_public"), u.keyTypePriInput && o.product_key_type_codes.push("qr_secure"), u.keyTypeRFIDInput && o.product_key_type_codes.push("rfid"), o.shelf_life = u.expireDate - 0, o.shelf_life_interval = u.expireDateUnit, o.status_code = "待审核";
      var s = {};
      s.version = c, s.details = [];
      for (var l in u.productInfos)"" != u.productInfos[l].key && "" != u.productInfos[l].value && s.details.push({
        name: u.productInfos[l].key,
        value: u.productInfos[l].value
      });
      s.contact = {hotline: u.hotline, support: u.support}, s.e_commerce = [];
      for (var d in u.productCommerce)"" != u.productCommerce[d].title && "" != u.productCommerce[d].url && s.e_commerce.push({
        title: u.productCommerce[d].title,
        url: u.productCommerce[d].url
      });
      s.t_commerce = [];
      for (var p in u.productAddress)"" != u.productAddress[p].address && "" != u.productAddress[p].tel && s.t_commerce.push({
        address: u.productAddress[p].address,
        tel: u.productAddress[p].tel
      });
      o.details = JSON.stringify(s);
      try {
        t.createProWithDetail(o, function (t) {
          null != t.id && "" != t.id && (r.queue[r.queue.length - 1].url = "/api/productbase/withdetailfile/" + t.id + "/full-mobile", r.queue[r.queue.length - 1].headers[e.YUNSOO_CONFIG.HEADER_ACCESS_TOKEN] = i, r.uploadAll(), e.utils.alert("success", "创建产品成功"), a.path("/product-base-manage"))
        }, function (t, n) {
          e.utils.alert("info", "创建产品失败")
        })
      } catch (f) {
      }
    }, n(function () {
      var t = $("#divImgWrap"), n = $("#fileInput"), o = $("#imgProductbase");
      "undefined" == typeof FileReader ? t.html("您的浏览器不支持图片预览") : n.change(function () {
        var t = r.queue[r.queue.length - 1]._file, n = new FileReader;
        n.readAsDataURL(t), n.onload = function (t) {
          u.proPicPreview = !0, e.$apply(), o.attr("src", this.result), e.fileInput = this.result
        }, r.queue = r.queue.slice(r.queue.length - 1, r.queue.length)
      })
    }, 0)
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("groupService", ["$http", function (e) {
    return {
      getGroups: function (t, n) {
        return e.get("/api/group").success(t), this
      }, createGroup: function (t, n, o) {
        return e.post("/api/group", t).success(n).error(o), this
      }, getCurrentOrgAccounts: function (t) {
        var n = "/api/account";
        return e.get(n).success(t), this
      }, getCurrentGroupAccounts: function (t, n) {
        var o = "/api/group/" + t + "/account";
        return e.get(o).success(n), this
      }, addAccountsToGroup: function (t, n, o, a) {
        var c = "/api/group/" + t + "/account";
        return e.put(c, n).success(o).error(a), this
      }, deleteGroup: function (t, n, o) {
        return e["delete"]("/api/group/" + t).success(n), this
      }, authGroup: function (t, n, o, a) {
        var c = "/api/group/" + t + "/grouppermissionpolicy";
        return e.post(c, n).success(o).error(a), this
      }, cancelAuthGroup: function (t, n, o, a) {
        var c = "/api/group/" + t + "/grouppermissionpolicy?policy_code=" + n;
        return e["delete"](c).success(o).error(a), this
      }, getGroupAllPermissions: function (t, n, o) {
        var a = "/api/group/" + t + "/permission";
        e.get(a).success(n)
      }
    }
  }]), e.controller("groupCtrl", ["$scope", "$timeout", "$route", "groupService", "YUNSOO_CONFIG", function (e, t, n, o, a) {
    var c = a.PAGE_ACCESS.RESOURCE, r = a.PAGE_ACCESS.ACTION, i = {
      sortable: {
        target: "#sort-bar",
        sort: "createdDateTime,desc"
      }, pageable: {page: 0, size: 20}, flush: function (e) {
        o.getGroups(function (t, n, o) {
          e({data: t, headers: o})
        })
      }
    }, u = e.groupPermission = {
      dashBoardRead: "",
      productKeyRead: "",
      productKeyMng: "",
      packageRead: "",
      packageMng: "",
      logisticsRead: "",
      logisticsMng: "",
      reportRead: "",
      productRead: "",
      productMng: "",
      msgRead: "",
      msgMng: "",
      deviceRead: "",
      deviceMng: "",
      accountRead: "",
      accountMng: "",
      groupRead: "",
      groupMng: "",
      passwordRead: ""
    };
    o.getCurrentOrgAccounts(function (e) {
      s.curOrgAccounts = e
    });
    var s = e.group = {
      name: "",
      description: "",
      spinnerShow: !1,
      curDeleteGroup: "",
      curDeleteGroupName: "",
      curSelectGroup: "",
      groupTable: new e.utils.DataTable(i),
      curOrgAccounts: "",
      selectAccounts: [],
      auth: {
        disableAll: !1, checkAllAccess: function (e) {
          u.dashBoardRead = e, u.productKeyRead = e, u.productKeyMng = e, u.packageRead = e, u.packageMng = e, u.logisticsRead = e, u.logisticsMng = e, u.reportRead = e, u.productRead = e, u.productMng = e, u.msgRead = e, u.msgMng = e, u.deviceRead = e, u.deviceMng = e, u.accountRead = e, u.accountMng = e, u.groupRead = e, u.groupMng = e, u.passwordRead = e
        }, authDashBoardRead: function () {
          u.dashBoardRead ? o.authGroup(s.curSelectGroup, {policy_code: c.DASHBOARD + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.DASHBOARD + ":" + r.READ, function () {
          }, function () {
          })
        }, authProductKeyRead: function () {
          u.productKeyRead ? o.authGroup(s.curSelectGroup, {policy_code: c.PRODUCTKEY + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PRODUCTKEY + ":" + r.READ, function () {
          }, function () {
          })
        }, authProductKeyMng: function () {
          u.productKeyMng ? o.authGroup(s.curSelectGroup, {policy_code: c.PRODUCTKEY + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PRODUCTKEY + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authPackageRead: function () {
          u.packageRead ? o.authGroup(s.curSelectGroup, {policy_code: c.PACKAGE + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PACKAGE + ":" + r.READ, function () {
          }, function () {
          })
        }, authPackageMng: function () {
          u.packageMng ? o.authGroup(s.curSelectGroup, {policy_code: c.PACKAGE + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PACKAGE + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authLogisticsRead: function () {
          u.logisticsRead ? o.authGroup(s.curSelectGroup, {policy_code: c.LOGISTICS + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.LOGISTICS + ":" + r.READ, function () {
          }, function () {
          })
        }, authLogisticsMng: function () {
          u.logisticsMng ? o.authGroup(s.curSelectGroup, {policy_code: c.LOGISTICS + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.LOGISTICS + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authReportRead: function () {
          u.reportRead ? o.authGroup(s.curSelectGroup, {policy_code: c.REPORT + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.REPORT + ":" + r.READ, function () {
          }, function () {
          })
        }, authProductRead: function () {
          u.productRead ? o.authGroup(s.curSelectGroup, {policy_code: c.PRODUCTBASE + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PRODUCTBASE + ":" + r.READ, function () {
          }, function () {
          })
        }, authProductMng: function () {
          u.productMng ? o.authGroup(s.curSelectGroup, {policy_code: c.PRODUCTBASE + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PRODUCTBASE + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authMsgRead: function () {
          u.msgRead ? o.authGroup(s.curSelectGroup, {policy_code: c.MESSAGE + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.MESSAGE + ":" + r.READ, function () {
          }, function () {
          })
        }, authMsgMng: function () {
          u.msgMng ? o.authGroup(s.curSelectGroup, {policy_code: c.MESSAGE + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.MESSAGE + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authDeviceRead: function () {
          u.deviceRead ? o.authGroup(s.curSelectGroup, {policy_code: c.DEVICE + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.DEVICE + ":" + r.READ, function () {
          }, function () {
          })
        }, authDeviceMng: function () {
          u.deviceMng ? o.authGroup(s.curSelectGroup, {policy_code: c.DEVICE + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.DEVICE + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authGroupRead: function () {
          u.accountRead ? o.authGroup(s.curSelectGroup, {policy_code: c.ACCOUNT + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.ACCOUNT + ":" + r.READ, function () {
          }, function () {
          })
        }, authGroupMng: function () {
          u.accountMng ? o.authGroup(s.curSelectGroup, {policy_code: c.ACCOUNT + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.ACCOUNT + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authGroupRead: function () {
          u.groupRead ? o.authGroup(s.curSelectGroup, {policy_code: c.GROUP + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.GROUP + ":" + r.READ, function () {
          }, function () {
          })
        }, authGroupMng: function () {
          u.groupMng ? o.authGroup(s.curSelectGroup, {policy_code: c.GROUP + ":" + r.MANAGE}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.GROUP + ":" + r.MANAGE, function () {
          }, function () {
          })
        }, authPasswordRead: function () {
          u.passwordRead ? o.authGroup(s.curSelectGroup, {policy_code: c.PROFILE + ":" + r.READ}, function () {
          }, function () {
          }) : o.cancelAuthGroup(s.curSelectGroup, c.PROFILE + ":" + r.READ, function () {
          }, function () {
          })
        }, showAuthGroupModal: function (e) {
          s.curSelectGroup = e, s.auth.checkAllAccess(!1), s.auth.disableAll = !1, o.getGroupAllPermissions(e, function (e) {
            for (var t = 0; t < e.length; t++) {
              if ("*" == e[t].resource_code && "*" == e[t].action_code) {
                s.auth.disableAll = !0, s.auth.checkAllAccess(!0);
                break
              }
              e[t].resource_code == c.DASHBOARD && e[t].action_code == r.READ && (u.dashBoardRead = !0), e[t].resource_code == c.PRODUCTKEY && e[t].action_code == r.READ && (u.productKeyRead = !0), e[t].resource_code == c.PRODUCTKEY && e[t].action_code == r.MANAGE && (u.productKeyMng = !0), e[t].resource_code == c.PACKAGE && e[t].action_code == r.READ && (u.packageRead = !0), e[t].resource_code == c.PACKAGE && e[t].action_code == r.MANAGE && (u.packageMng = !0), e[t].resource_code == c.LOGISTICS && e[t].action_code == r.READ && (u.logisticsRead = !0), e[t].resource_code == c.LOGISTICS && e[t].action_code == r.MANAGE && (u.logisticsMng = !0), e[t].resource_code == c.REPORT && e[t].action_code == r.READ && (u.reportRead = !0), e[t].resource_code == c.PRODUCTBASE && e[t].action_code == r.READ && (u.productRead = !0), e[t].resource_code == c.PRODUCTBASE && e[t].action_code == r.MANAGE && (u.productMng = !0), e[t].resource_code == c.MESSAGE && e[t].action_code == r.READ && (u.msgRead = !0), e[t].resource_code == c.MESSAGE && e[t].action_code == r.MANAGE && (u.msgMng = !0), e[t].resource_code == c.DEVICE && e[t].action_code == r.READ && (u.deviceRead = !0), e[t].resource_code == c.DEVICE && e[t].action_code == r.MANAGE && (u.deviceMng = !0), e[t].resource_code == c.ACCOUNT && e[t].action_code == r.READ && (u.accountRead = !0), e[t].resource_code == c.ACCOUNT && e[t].action_code == r.MANAGE && (u.accountMng = !0), e[t].resource_code == c.GROUP && e[t].action_code == r.READ && (u.groupRead = !0), e[t].resource_code == c.GROUP && e[t].action_code == r.MANAGE && (u.groupMng = !0), e[t].resource_code == c.PROFILE && e[t].action_code == r.READ && (u.passwordRead = !0)
            }
            $("#treeMenuModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
              $(this).removeData("bs.modal")
            })
          })
        }, hideAuthGroupModal: function () {
          s.curSelectGroup = "", $("#treeMenuModal").modal("hide")
        }
      },
      showGroupModal: function () {
        $("#myModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
          $(this).removeData("bs.modal")
        })
      },
      showAddAccountModal: function (e) {
        s.curSelectGroup = e, o.getCurrentGroupAccounts(e, function (e) {
          "" != s.curOrgAccounts && $.each(s.curOrgAccounts, function (t, n) {
            var o = "<option value=" + n.id;
            void 0 != e && e.length > 0 && $.each(e, function (e, t) {
              t.id == n.id && (o += " selected = 'selected'")
            }), o += ">" + n.last_name + n.first_name + "</option>", $("#selectAccount").append(o)
          }), $("#selectAccount").chosen({width: "100%"}), $("#selectAccount").change(function () {
            s.selectAccounts = $(this).val()
          }), $("#addAccountsModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
            $(this).removeData("bs.modal")
          })
        }, function () {
          "" != s.curOrgAccounts && $.each(s.curOrgAccounts, function (e, t) {
            var n = "<option value=" + t.id + ">" + t.last_name + t.first_name + "</option>";
            $("#selectAccount").append(n)
          }), $("#selectAccount").chosen({width: "100%"}), $("#selectAccount").change(function () {
            s.selectAccounts = $(this).val()
          }), $("#addAccountsModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
            $(this).removeData("bs.modal")
          })
        })
      },
      hideAddAccountsModal: function () {
        s.curSelectGroup = "", s.spinnerShow = !1, $("#selectAccount").chosen("destroy"), $("#selectAccount").html(""), $("#addAccountsModal").modal("hide")
      },
      addAccountsToGroup: function () {
        s.spinnerShow = !0, "" != s.curSelectGroup && o.addAccountsToGroup(s.curSelectGroup, s.selectAccounts || [], function (t) {
          s.hideAddAccountsModal(), e.utils.alert("info", "账号更新成功")
        }, function (t) {
          s.spinnerShow = !1, e.utils.alert("danger", "账号更新失败", "#addAccountsModal .modal-dialog", !1)
        })
      },
      deleteGroup: function (e, t) {
        s.curDeleteGroup = e, s.curDeleteGroupName = t, $("#deleteConfirmDialog").modal({
          backdrop: "static",
          keyboard: !1
        }).on("hidden.bs.modal", function () {
          $(this).removeData("bs.modal")
        })
      },
      deleteGroupConfirm: function () {
        "" != s.curDeleteGroup && o.deleteGroup(s.curDeleteGroup, function (t, n) {
          $("#deleteConfirmDialog").modal("hide"), e.utils.alert("info", "账号组删除成功"), s.groupTable = new e.utils.DataTable(i)
        })
      },
      deleteGroupCancel: function () {
        s.curDeleteGroup = "", $("#deleteConfirmDialog").modal("hide")
      },
      createGroup: function (t) {
        if (!t)return void e.utils.alert("info", "页面验证有错误，请返回检查");
        s.spinnerShow = !0;
        var n = {name: s.name, description: s.description};
        o.createGroup(n, function (t) {
          s.spinnerShow = !1, $("#myModal").modal("hide"), e.utils.alert("info", "账号组创建成功"), this.groupTable = new e.utils.DataTable(i)
        }, function (t) {
          e.utils.alert("danger", "账号组创建失败", "#myModal .modal-dialog", !1)
        })
      }
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.filter("startFrom", function () {
    return function (e, t) {
      return e && e.length ? e.slice(t - 1) : void 0
    }
  }), e.factory("logisticsManageService", ["$http", function (e) {
    return {
      uploadLogisticsFile: function (t, n, o) {
        return e.post("/api/logistics/file", t).success(function (e) {
        }).error(function (e, t) {
        }), this
      }, getLogisticsHistoryInfoCount: function (t, n) {
        return e.get("/api/productfile/count?status=0&&filetype=2").success(function (e) {
          t(e)
        }).error(function (e, n) {
          t()
        }), this
      }, getLogisticsHistoryInfo: function (t, n, o) {
        return e.get("/api/productfile?status=0&&filetype=2&&pageIndex=" + t).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        }), this
      }
    }
  }]), e.controller("LogisticsManageCtrl", ["$scope", "FileUploader", "logisticsManageService", function (e, t, n) {
    var o = e.uploader = new t({url: "/api/logistics/file"});
    e.showDesc = !1;
    var a = e.utils.auth.getAccessToken();
    a && (o.headers[e.YUNSOO_CONFIG.HEADER_ACCESS_TOKEN] = a), o.filters.push({
      name: "customFilter",
      fn: function (e, t) {
        return this.queue.length < 10
      }
    }), o.onWhenAddingFileFailed = function (e, t, n) {
      console.info("onWhenAddingFileFailed", e, t, n)
    }, o.onAfterAddingFile = function (e) {
      console.info("onAfterAddingFile", e)
    }, o.onAfterAddingAll = function (e) {
      console.info("onAfterAddingAll", e)
    }, o.onBeforeUploadItem = function (e) {
      console.info("onBeforeUploadItem", e)
    }, o.onProgressItem = function (e, t) {
      console.info("onProgressItem", e, t)
    }, o.onProgressAll = function (e) {
      console.info("onProgressAll", e)
    }, o.onSuccessItem = function (t, n, o, a) {
      console.info("onSuccessItem", n, o), e.utils.alert("success", "上传成功！")
    }, o.onErrorItem = function (e, t, n, o) {
      console.info("onErrorItem", e, t, n, o)
    }, o.onCancelItem = function (e, t, n, o) {
      console.info("onCancelItem", e, t, n, o)
    }, o.onCompleteItem = function (e, t, n, o) {
      console.info("onCompleteItem", t, n), r(0)
    }, o.onCompleteAll = function () {
      r(0)
    };
    var c = function (t) {
      function n() {
        return t.length > 0 ? 1 : 0
      }

      function o() {
        this.onFirstPage() || (e.currentPage = 0, r(e.currentPage))
      }

      function a() {
        this.onLastPage() || (e.currentPage = Math.ceil(e.totalCounts / this.pageSize) - 1, r(e.currentPage))
      }

      function c(t) {
        e.currentPage = t, r(e.currentPage)
      }

      function i() {
        return e.currentPage
      }

      function u() {
        for (var t = [], n = Math.max(0, e.currentPage - 4); n <= e.currentPage; n++)t.push(n);
        return t
      }

      function s() {
        this.onLastPage() || (e.currentPage += 1, r(e.currentPage))
      }

      function l() {
        this.onFirstPage() || (e.currentPage -= 1, r(e.currentPage))
      }

      function d() {
        return 0 === e.currentPage
      }

      function p() {
        return t.length < this.pageSize
      }

      var f = {
        data: t,
        filteredData: {},
        pageSize: 10,
        pages: u,
        isShowHisSec: n,
        goToFirstPage: o,
        gotoLastPage: a,
        goToPage: c,
        currentPage: i,
        next: s,
        previous: l,
        onFirstPage: d,
        onLastPage: p
      };
      return f
    };
    e.currentPage = 0, e.totalCounts = 0, e.itemIndex = 0, n.getLogisticsHistoryInfoCount(function (t) {
      e.totalCounts = t
    });
    var r = function (t) {
      n.getLogisticsHistoryInfo(t, function (t) {
        e.data = t, e.dataTable = new c(e.data), e.isShowHisSec = e.data.length > 0 ? 1 : 0, e.itemIndex = 0
      })
    };
    r(0)
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("logisticsService", ["$http", function (e) {
    return {
      getInfo: function (t, n, o) {
        e.get("/api/logistics/" + t).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        })
      }
    }
  }]), e.controller("LogisticsCtrl", ["$scope", "logisticsService", function (e, t) {
    e.productKey = "", e.bodyShow = 0, e.productKeyClick = function () {
      return null == e.productKey || "" == e.productKey ? void(e.bodyShow = 0) : void t.getInfo(e.productKey, function (t) {
        e.bodyShow = 1, e.data = t
      })
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("messageService", ["$http", function (e) {
    return {
      getMessages: function (t, n, o) {
        var a = "/api/message?";
        n && (a += "org_id=" + n + "&"), a += t.toString(), e.get(a).success(o)
      }, createMessage: function (t, n, o) {
        e.post("/api/message", t).success(n).error(o)
      }
    }
  }]), e.controller("MessageCtrl", ["$scope", "$timeout", "messageService", function (e, t, n) {
    function o(t) {
      e.messageTable = new e.utils.DataTable({
        sortable: {target: "#sort-bar", sort: "createdDateTime,desc"},
        pageable: {page: 0, size: 200},
        flush: function (e) {
          n.getMessages(this, t, function (t, n, o) {
            e({data: t, headers: o})
          })
        }
      })
    }

    e.spinnerShow = !1;
    var a = e.message = {title: "", body: "", type: "business", org_id: "", link: ""};
    e.context.organization ? (e.message.org_id = e.context.organization.id, o(e.message.org_id)) : e.$on("context-organization-ready", function (t) {
      e.message.org_id = e.context.organization.id, o(e.message.org_id)
    });
    var c = {business: "商家信息", platform: "云溯平台信息"}, r = {created: "已创建", approved: "通过审核", deleted: "已删除"};
    e.formatMessageType = function (e) {
      return c[e] || e
    }, e.formatMessageStatus = function (e) {
      return r[e] || e
    }, t(function () {
      $("#msgForm").bootstrapValidator({
        message: "非法输入",
        feedbackIcons: {
          valid: "fa fa-check-circle fa-lg text-success",
          invalid: "fa fa-times-circle fa-lg",
          validating: "fa fa-refresh"
        },
        fields: {
          title: {validators: {notEmpty: {message: "消息标题不能为空"}}},
          body: {validators: {notEmpty: {message: "消息正文不能为空"}}},
          link: {validators: {notEmpty: {message: "链接不能为空"}}}
        }
      }).on("success.field.bv", function (e, t) {
        e.preventDefault()
      })
    }, 0), e.submit = function () {
      return "" == a.title ? void e.utils.alert("info", "消息标题不能为空", "#myModal .modal-dialog", !1) : "" == a.body ? void e.utils.alert("info", "消息正文不能为空", "#myModal .modal-dialog", !1) : "" == a.link ? void e.utils.alert("info", "链接不能为空", "#myModal .modal-dialog", !1) : (e.spinnerShow = !0, void n.createMessage(a, function () {
        e.spinnerShow = !1, $("#myModal").modal("hide"), "" != e.message.org_id && o(e.message.org_id), e.utils.alert("info", "创建消息成功")
      }))
    }, e.showModal = function () {
      $("#myModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
        $(this).removeData("bs.modal")
      })
    }, e.hideModal = function () {
      $("#myModal").modal("hide")
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("operationService", ["$http", function (e) {
    return {
      getInfo: function (t, n, o) {
        e.get("/api/logistics/" + t).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        })
      }
    }
  }]), e.controller("OperationCtrl", ["$scope", "operationService", function (e, t) {
    e.productKey = "", e.bodyShow = 0, e.packageClick = function () {
      return null == e.productKey || "" == e.productKey ? void(e.bodyShow = 0) : void logisticsService.getInfo(e.productKey, function (t) {
        e.bodyShow = 1, e.data = t
      })
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("packageSearchService", ["$http", function (e) {
    return {
      getInfo: function (t, n, o) {
        e.get("/api/package/" + t).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        })
      }
    }
  }]), e.controller("PackageSearchCtrl", ["$scope", "packageSearchService", function (e, t) {
    function n(e) {
      if (null != e) {
        var t = {};
        t.text = e.key, t.nodes = [];
        var o = {};
        if (o.text = "产品数量: (" + e.productCount + ")", t.nodes.push(o),
            null != e.subPackages) {
          if (e.subPackages instanceof Array)for (var a in e.subPackages)t.nodes.push(n(e.subPackages[a])); else t.nodes.push(n(e.subPackages));
          return t
        }
      }
    }

    e.productKey = "", e.bodyShow = 0, e.productKeyClick = function () {
      return null == e.productKey || "" == e.productKey ? void(e.bodyShow = 0) : void t.getInfo(e.productKey, function (t) {
        e.origialdata = t, e.resultdata = [], e.resultdata.push(n(t)), e.bodyShow = 1, $("#tree").treeview({
          data: e.resultdata,
          color: "#3c8dbc"
        })
      })
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("packageService", ["$http", function (e) {
    return {
      getInfo: function (t, n, o) {
        return e.get("/api/package/" + productKey).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        }), this
      }, uploadPackageFile: function (t, n, o) {
        return e.post("/api/package/file", t).success(function (e) {
        }).error(function (e, t) {
        }), this
      }, getPackageHistoryInfoCount: function (t, n) {
        return e.get("/api/productfile/count?status=0&&filetype=1").success(function (e) {
          t(e)
        }).error(function (e, n) {
          t()
        }), this
      }, getPackageHistoryInfo: function (t, n, o) {
        return e.get("/api/productfile?status=0&&filetype=1&&pageIndex=" + t).success(function (e) {
          n(e)
        }).error(function (e, t) {
          n()
        }), this
      }
    }
  }]), e.controller("PackageCtrl", ["$scope", "FileUploader", "packageService", function (e, t, n) {
    var o = e.uploader = new t({url: "/api/package/file"});
    e.showDesc = !1;
    var a = e.utils.auth.getAccessToken();
    a && (o.headers[e.YUNSOO_CONFIG.HEADER_ACCESS_TOKEN] = a), o.filters.push({
      name: "customFilter",
      fn: function (e, t) {
        return this.queue.length < 10
      }
    }), o.onWhenAddingFileFailed = function (e, t, n) {
      console.info("onWhenAddingFileFailed", e, t, n)
    }, o.onAfterAddingFile = function (e) {
      console.info("onAfterAddingFile", e)
    }, o.onAfterAddingAll = function (e) {
      console.info("onAfterAddingAll", e)
    }, o.onBeforeUploadItem = function (e) {
      console.info("onBeforeUploadItem", e)
    }, o.onProgressItem = function (e, t) {
      console.info("onProgressItem", e, t)
    }, o.onProgressAll = function (e) {
      console.info("onProgressAll", e)
    }, o.onSuccessItem = function (t, n, o, a) {
      console.info("onSuccessItem", n, o), e.utils.alert("success", "上传成功！")
    }, o.onErrorItem = function (e, t, n, o) {
      console.info("onErrorItem", e, t, n, o)
    }, o.onCancelItem = function (e, t, n, o) {
      console.info("onCancelItem", e, t, n, o)
    }, o.onCompleteItem = function (e, t, n, o) {
      console.info("onCompleteItem", t, n), r(0)
    }, o.onCompleteAll = function () {
      r(0)
    };
    var c = function (t) {
      function n() {
        return t.length > 0 ? 1 : 0
      }

      function o() {
        this.onFirstPage() || (e.currentPage = 0, r(e.currentPage))
      }

      function a() {
        this.onLastPage() || (e.currentPage = Math.ceil(e.totalCounts / this.pageSize) - 1, r(e.currentPage))
      }

      function c(t) {
        e.currentPage = t, r(e.currentPage)
      }

      function i() {
        return e.currentPage
      }

      function u() {
        for (var t = [], n = Math.max(0, e.currentPage - 4); n <= e.currentPage; n++)t.push(n);
        return t
      }

      function s() {
        this.onLastPage() || (e.currentPage += 1, r(e.currentPage))
      }

      function l() {
        this.onFirstPage() || (e.currentPage -= 1, r(e.currentPage))
      }

      function d() {
        return 0 === e.currentPage
      }

      function p() {
        return t.length < this.pageSize
      }

      var f = {
        data: t,
        filteredData: {},
        pageSize: 10,
        pages: u,
        isShowHisSec: n,
        goToFirstPage: o,
        gotoLastPage: a,
        goToPage: c,
        currentPage: i,
        next: s,
        previous: l,
        onFirstPage: d,
        onLastPage: p
      };
      return f
    };
    e.currentPage = 0, e.totalCounts = 0, e.itemIndex = 0, e.getItemIndex = function () {
      return e.itemIndex += 1, e.itemIndex
    }, n.getPackageHistoryInfoCount(function (t) {
      e.totalCounts = t
    });
    var r = function (t) {
      n.getPackageHistoryInfo(t, function (t) {
        e.data = t, e.dataTable = new c(e.data), e.isShowHisSec = e.data.length > 0 ? 1 : 0, e.itemIndex = 0
      })
    };
    r(0)
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("productBaseManageService", ["$http", function (e) {
    return {
      getProductBases: function (t) {
        return e.get("/api/productbase").success(t), this
      }, getProductKeyCredits: function (t) {
        return e.get("/api/productkeycredit").success(t), this
      }
    }
  }]), e.controller("ProductBaseManageCtrl", ["$scope", "productBaseManageService", function (e, t) {
    function n(n) {
      t.getProductKeyCredits(function (t) {
        var o = {general: {total: 0, remain: 0}, creditMap: {}};
        $.each(t, function (e, t) {
          t.product_base_id ? o.creditMap[t.product_base_id] = {
            total: t.total,
            remain: t.remain
          } : o.general = {total: t.total, remain: t.remain}
        }), e.productKeyCredits = o, console.log("[productKeyCredits loaded]", o), n(o)
      })
    }

    function o(e, t) {
      $.each(e, function (e, n) {
        if (n && t) {
          var o = n.credit = {total: 0, remain: 0, general: t.general};
          o.total += t.general.total, o.remain += t.general.remain, t.creditMap[n.id] && (o.total += t.creditMap[n.id].total, o.remain += t.creditMap[n.id].remain), o.percentage = 100 * o.remain / o.total | 0
        }
      })
    }

    e.SHELFLIFE_INTERVALS = {
      year: "年",
      month: "月",
      week: "周",
      day: "天",
      hour: "小时"
    }, e.formatProductKeyTypes = function (e) {
      var t = "";
      return e && $.each(e, function (n, o) {
        t += o.name, n < e.length - 1 && (t += ", ")
      }), t
    }, e.formatComments = function (e) {
      return e || (e = ""), e.length > 30 ? e.substring(0, 30) + "..." : e
    }, e.dataTable = new e.utils.DataTable({
      pageable: {page: 0, size: 20}, flush: function (a) {
        t.getProductBases(function (t, c, r) {
          e.productKeyCredits ? o(t, e.productKeyCredits) : n(function (e) {
            o(t, e)
          }), a({data: t, headers: r})
        })
      }
    })
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("productKeyManageService", ["$http", function (e) {
    return {
      getProductKeyBatches: function (t, n) {
        return e.get("/api/productkeybatch" + (t ? "?product_base_id=" + t : "")).success(n), this
      }, getProductKeyBatchesPaged: function (t, n, o) {
        var a = "/api/productkeybatch?";
        return n && (a += "product_base_id=" + n + "&"), a += t.toString(), e.get(a).success(o), this
      }, getProductBases: function (t) {
        return e.get("/api/productbase").success(t), this
      }, getProductKeyCredits: function (t) {
        return e.get("/api/productkeycredit").success(t), this
      }, getAccountById: function (t, n) {
        return e.get("/api/account/" + t).success(n), this
      }, createProductKeyBatch: function (t, n, o) {
        return e.post("/api/productkeybatch", t).success(n).error(o), this
      }, downloadProductKeys: function (e, t, n) {
        e.downloadFrameSrc = "/api/productkeybatch/" + t + "/keys?" + n
      }
    }
  }]), e.controller("ProductKeyManageCtrl", ["$scope", "productKeyManageService", "$timeout", function (e, t, n) {
    function o(e, t) {
      if (e && t) {
        var n = e.credit = {total: 0, remain: 0, general: t.general};
        n.total += t.general.total, n.remain += t.general.remain, t.creditMap[e.id] && (n.total += t.creditMap[e.id].total, n.remain += t.creditMap[e.id].remain), n.percentage = 100 * n.remain / n.total | 0
      }
    }

    e.cache || (e.cache = {});
    var a = e.creationPanel = {
      disableSubmit: !0, model: {productBaseId: 0, quantity: 0}, hideModal: function () {
        e.spinnerShow = !1, $("#myModal").modal("hide")
      }, create: function () {
        var n = this.model;
        console.log("[before productKeyBatch create]", n), n.quantity = $("#rangeResult").html().replace(/\,/g, "") - 0;
        var o = {quantity: n.quantity, product_base_id: n.productBaseId}, a = this.selectedProductBase;
        e.spinnerShow = !0, t.createProductKeyBatch(o, function (t) {
          console.log("[newProductKeyBatch created]", t), t.product_base = a, a.credit.remain -= o.quantity, e.listPanel.newProductKeyBatches.push(t), e.spinnerShow = !1, $("#myModal").modal("hide"), e.utils.alert("success", "产品码创建成功")
        }, function (t, n) {
          console.log(t, n);
          var o = (t.message || "").substring(0, 100);
          e.spinnerShow = !1, e.utils.alert("danger", o, "#myModal .modal-dialog", !1)
        })
      }, productBaseIdChanged: function (e) {
        console.log("[productBaseId changed]", e);
        var t = null;
        $.each(this.productBases, function (n, o) {
          o && o.id === e && (t = o, console.log("[selectedProductBase]", t))
        }), a.disableSubmit = null == t ? !0 : !1, this.selectedProductBase = t, $("#chartProKeyRemain").empty(), $("#chartProKeyRemain").data("text", t.credit.remain), $("#chartProKeyRemain").data("info", "总额：" + t.credit.total), t.credit.remain / t.credit.total < .01 ? $("#chartProKeyRemain").data("percent", 1) : $("#chartProKeyRemain").data("percent", t.credit.percentage), $("#chartProKeyRemain").circliful()
      }
    };
    e.listPanel = {
      table: new e.utils.DataTable({
        sortable: {target: "#sort-bar", sort: "createdDateTime,desc"},
        pageable: {page: 0, size: 20},
        flush: function (e) {
          t.getProductKeyBatchesPaged(this, null, function (t, n, o) {
            e({data: t, headers: o})
          })
        }
      }), newProductKeyBatches: [], download: function (n) {
        if (n) {
          var o = e.utils.auth.getAccessToken(), a = o ? e.YUNSOO_CONFIG.PARAMETER_ACCESS_TOKEN + "=" + o : "";
          t.downloadProductKeys(this, n, a)
        }
      }, downloadFrameSrc: ""
    }, e.formatProductKeyTypes = function (e) {
      var t = "";
      return e && $.each(e, function (n, o) {
        t += o.name, n < e.length - 1 && (t += ", ")
      }), t
    }, e.cache.accounts || (e.cache.accounts = []), e.getAccountCached = function (n) {
      var o = e.cache.accounts;
      return o[n] ? o[n] : (o[n] = "加载中", void t.getAccountById(n, function (e) {
        o[n] = e
      }))
    }, t.getProductBases(function (n) {
      e.productBases = e.creationPanel.productBases = n, e.productBaseMap = e.utils.arrayToMap(e.productBases, "id"), e.productBases && t.getProductKeyCredits(function (t) {
        var n = {general: {total: 0, remain: 0}, creditMap: {}};
        $.each(t, function (e, t) {
          t.product_base_id ? n.creditMap[t.product_base_id] = {
            total: t.total,
            remain: t.remain
          } : n.general = {total: t.total, remain: t.remain}
        }), e.productKeyCredits = n, console.log("[productKeyCredits loaded]", n), $.each(e.productBases, function (e, t) {
          o(t, n)
        })
      })
    }), e.showModal = function () {
      function t(e, t, n) {
        e = e.toString();
        var o = e.length;
        if (o > t) {
          var a = o % t, c = parseInt(o / t), r = [], i = e.substr(0, a);
          "" != i && r.push(i);
          for (var u = 0; c > u; u++)r.push(e.substr(a + u * t, t));
          e = r.join(n)
        }
        return e
      }

      $("#myModal").modal({backdrop: "static", keyboard: !1}).on("hidden.bs.modal", function () {
        $(this).removeData("bs.modal")
      });
      var n = {"个": "1", "十": "10", "百": "100", "千": "1000", "万": "10000", "十万": "100000"};
      $("#rangeNum").ionRangeSlider({
        type: "single", min: 1, max: 100, grid: !0, onChange: function (o) {
          var a = (o.from - 0) * (n[$("#rangeKey").data("from")] - 0), c = e.creationPanel.selectedProductBase.credit.remain;
          a > c ? ($("#btnSubmit").attr("disabled", "disabled"), $("#rangeResult").css("color", "red"), $("#rangeResult").html(t(a, 3, ",") + "  余额不足")) : ($("#btnSubmit").removeAttr("disabled"), $("#rangeResult").css("color", "#515151"), $("#rangeResult").html(t(a, 3, ",")))
        }
      }), $("#rangeKey").ionRangeSlider({
        grid: !0, values: ["个", "十", "百", "千", "万", "十万"], onChange: function (o) {
          var a = ($("#rangeNum").data("from") - 0) * (n[$("#rangeKey").data("from")] - 0), c = e.creationPanel.selectedProductBase.credit.remain;
          a > c ? ($("#btnSubmit").attr("disabled", "disabled"), $("#rangeResult").css("color", "red"), $("#rangeResult").html(t(a, 3, ",") + "  余额不足")) : ($("#btnSubmit").removeAttr("disabled"), $("#rangeResult").css("color", "#515151"), $("#rangeResult").html(t(a, 3, ",")))
        }
      })
    }
  }])
}(), function () {
  var e = angular.module("root");
  e.controller("SearchCtrl", ["$scope", function (e) {
  }])
}(), function () {
  var e = angular.module("root");
  e.factory("settingService", ["$http", function (e) {
    return {
      updatePassword: function (t, n, o) {
        return e.post("/api/account/current/password", t).success(n).error(o), this
      }
    }
  }]), e.controller("SettingCtrl", ["$scope", "settingService", "$timeout", function (e, t, n) {
    e.originalPassword = "", e.currentPassword = "", e.confirmPassword = "", n(function () {
      $("#updatePassword").bootstrapValidator({
        message: "输入密码不合法",
        feedbackIcons: {
          valid: "fa fa-check-circle fa-lg text-success",
          invalid: "fa fa-times-circle fa-lg",
          validating: "fa fa-refresh"
        },
        fields: {
          oldPassword: {validators: {notEmpty: {message: "请输入当前密码"}}},
          curPassword: {validators: {notEmpty: {message: "请输入修改密码"}}},
          confirmPassword: {
            validators: {
              notEmpty: {message: "请输入确认密码"},
              identical: {field: "curPassword", message: "确认密码与修改密码不一致"}
            }
          }
        }
      }).on("success.field.bv", function (e, t) {
        var n = t.element.parents(".form-group");
        n.removeClass("has-success")
      })
    }, 0), e.submit = function () {
      if ("" == e.originalPassword)return void e.utils.alert("warning", "请输入原密码！");
      if ("" == e.currentPassword)return void e.utils.alert("warning", "请输入修改密码！");
      if (e.currentPassword != e.confirmPassword)return void e.utils.alert("warning", "确认密码与修改入密码不一致！");
      var n = {old_password: e.originalPassword, new_password: e.currentPassword};
      t.updatePassword(n, function (t) {
        e.utils.alert("success", "修改密码成功！")
      }, function (t) {
        e.utils.alert("warning", "修改密码失败！")
      })
    }
  }])
}();